{
  "name": "DiscordçµŒç”±äºˆå®šèª¿æ•´è‡ªå‹•åŒ–ã‚·ã‚¹ãƒ†ãƒ ",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "discord-schedule",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
      "name": "Discord ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        250,
        300
      ],
      "webhookId": "schedule-webhook",
      "credentials": {
        "httpHeaderAuth": {
          "id": "1",
          "name": "Discord Webhookèªè¨¼"
        }
      },
      "notes": "Discord Botã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡ã€‚å¤–éƒ¨Botã‹ã‚‰Webhookã§ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹"
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "getAll",
        "databaseId": "={{ $env.NOTION_PARTICIPANTS_DB_ID }}",
        "returnAll": true,
        "options": {}
      },
      "id": "b2c3d4e5-f6a7-8901-bcde-f12345678901",
      "name": "Notion å‚åŠ è€…ãƒã‚¹ã‚¿ãƒ¼å–å¾—",
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2,
      "position": [
        450,
        200
      ],
      "credentials": {
        "notionApi": {
          "id": "2",
          "name": "Notion API"
        }
      },
      "notes": "åå‰â†’ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å¤‰æ›ç”¨ã®ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿å–å¾—"
    },
    {
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "// è‡ªç„¶è¨€èªã‹ã‚‰äºˆå®šæƒ…å ±ã‚’æŠ½å‡ºï¼ˆAIå‡¦ç†ï¼‰\n// ã“ã®éƒ¨åˆ†ã¯å®Ÿéš›ã«ã¯AI APIã‚’å‘¼ã³å‡ºã™å¿…è¦ãŒã‚ã‚Šã¾ã™\n\nconst message = $input.first().json.message;\nconst userId = $input.first().json.user_id;\n\n// AIå‡¦ç†ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼\n// å®Ÿè£…æ™‚ã¯Claude APIã€OpenAI APIç­‰ã‚’å‘¼ã³å‡ºã—\nconst prompt = `ä»¥ä¸‹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰äºˆå®šæƒ…å ±ã‚’æŠ½å‡ºã—ã¦JSONå½¢å¼ã§è¿”ã—ã¦ãã ã•ã„ã€‚\nç¾åœ¨æ—¥æ™‚: ${new Date().toISOString()}\n\nãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ${message}\n\nå‡ºåŠ›å½¢å¼:\n{\n  \"date\": \"YYYY-MM-DD\",\n  \"start_time\": \"HH:mm\",\n  \"end_time\": \"HH:mm\",\n  \"title\": \"äºˆå®šã®ã‚¿ã‚¤ãƒˆãƒ«\",\n  \"participants\": [\"å‚åŠ è€…1\", \"å‚åŠ è€…2\"]\n}`;\n\n// TODO: AI APIå‘¼ã³å‡ºã—\n// const aiResponse = await callAIAPI(prompt);\n\n// ãƒ‡ãƒ¢ç”¨ã®ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆå®Ÿè£…æ™‚ã¯å‰Šé™¤ï¼‰\nconst parsed = {\n  date: \"2025-11-05\",\n  start_time: \"14:00\",\n  end_time: \"15:00\",\n  title: \"é€±æ¬¡ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°\",\n  participants: [\"ç”°ä¸­\", \"ä½è—¤\"]\n};\n\nreturn [{\n  json: {\n    ...parsed,\n    original_message: message,\n    user_id: userId\n  }\n}];"
      },
      "id": "c3d4e5f6-a7b8-9012-cdef-123456789012",
      "name": "è‡ªç„¶è¨€èªãƒ‘ãƒ¼ã‚¹ï¼ˆAIï¼‰",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        450,
        400
      ],
      "notes": "ã€AIã€‘Discord ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰æ—¥æ™‚ãƒ»ã‚¿ã‚¤ãƒˆãƒ«ãƒ»å‚åŠ è€…ã‚’æŠ½å‡º\nå®Ÿè£…æ™‚: Claude API / OpenAI API ç­‰ã‚’ä½¿ç”¨"
    },
    {
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "// å‚åŠ è€…åã‚’ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¤‰æ›ï¼ˆAIå‡¦ç†ï¼‰\n\nconst parsedData = $input.item(0).json;\nconst notionData = $input.item(1).json;\n\nconst participants = parsedData.participants || [];\nconst notionMaster = Array.isArray(notionData) ? notionData : [notionData];\n\n// AIå‡¦ç†: æ›–æ˜§ä¸€è‡´ã‚’è¡Œã†\n// ã€Œç”°ä¸­ã•ã‚“ã€â†’ã€Œç”°ä¸­å¤ªéƒã€â†’ã€Œtanaka@company.comã€\n\nconst participantsWithEmail = participants.map(name => {\n  // æ•¬ç§°ã‚’é™¤å»\n  const cleanName = name.replace(/ã•ã‚“|æ§˜|å›|æ®¿/g, '');\n  \n  // Notionãƒã‚¹ã‚¿ãƒ¼ã‹ã‚‰æ¤œç´¢\n  const match = notionMaster.find(person => {\n    const personName = person.properties?.åå‰?.title?.[0]?.plain_text || person.properties?.Name?.title?.[0]?.plain_text || '';\n    return personName.includes(cleanName) || cleanName.includes(personName);\n  });\n  \n  if (match) {\n    return {\n      name: cleanName,\n      email: match.properties?.ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹?.email || match.properties?.Email?.email || 'unknown@example.com',\n      found: true\n    };\n  } else {\n    return {\n      name: cleanName,\n      email: null,\n      found: false\n    };\n  }\n});\n\nreturn [{\n  json: {\n    ...parsedData,\n    participants_with_email: participantsWithEmail,\n    unmatched_participants: participantsWithEmail.filter(p => !p.found)\n  }\n}];"
      },
      "id": "d4e5f6a7-b8c9-0123-def1-234567890123",
      "name": "å‚åŠ è€…åâ†’ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å¤‰æ›ï¼ˆAIï¼‰",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        650,
        300
      ],
      "notes": "ã€AIã€‘Notionãƒã‚¹ã‚¿ãƒ¼ã‹ã‚‰å‚åŠ è€…ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—\næ›–æ˜§ä¸€è‡´å‡¦ç†ã‚’å®Ÿè£…"
    },
    {
      "parameters": {
        "calendar": "primary",
        "operation": "getAll",
        "returnAll": true,
        "options": {
          "timeMin": "={{ $json.date }}T00:00:00+09:00",
          "timeMax": "={{ DateTime.fromISO($json.date).plus({days: 2}).toISO() }}"
        }
      },
      "id": "e5f6a7b8-c9d0-1234-ef12-345678901234",
      "name": "Google Calendar æ—¢å­˜äºˆå®šå–å¾—",
      "type": "n8n-nodes-base.googleCalendar",
      "typeVersion": 1,
      "position": [
        850,
        300
      ],
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "3",
          "name": "Google Calendar API"
        }
      },
      "notes": "æŒ‡å®šæ—¥æ™‚ç¯„å›²ã®æ—¢å­˜äºˆå®šã‚’å–å¾—ï¼ˆå½“æ—¥+ç¿Œæ—¥ï¼‰"
    },
    {
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "// ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é‡è¤‡ãƒã‚§ãƒƒã‚¯\n\nconst requestedData = $input.first().json;\nconst existingEvents = $input.all().slice(1).map(item => item.json);\n\nconst requestedDate = requestedData.date;\nconst requestedStart = `${requestedDate}T${requestedData.start_time}:00+09:00`;\nconst requestedEnd = `${requestedDate}T${requestedData.end_time}:00+09:00`;\n\nconst requestedStartTime = new Date(requestedStart);\nconst requestedEndTime = new Date(requestedEnd);\n\n// é‡è¤‡ãƒã‚§ãƒƒã‚¯\nlet hasConflict = false;\nlet conflictingEvents = [];\n\nfor (const event of existingEvents) {\n  if (!event.start || !event.end) continue;\n  \n  const eventStart = new Date(event.start.dateTime || event.start.date);\n  const eventEnd = new Date(event.end.dateTime || event.end.date);\n  \n  // æ™‚é–“ãŒé‡è¤‡ã—ã¦ã„ã‚‹ã‹åˆ¤å®š\n  if (requestedStartTime < eventEnd && requestedEndTime > eventStart) {\n    hasConflict = true;\n    conflictingEvents.push({\n      title: event.summary,\n      start: eventStart.toISOString(),\n      end: eventEnd.toISOString()\n    });\n  }\n}\n\nreturn [{\n  json: {\n    ...requestedData,\n    conflict: hasConflict,\n    conflicting_events: conflictingEvents,\n    existing_events: existingEvents\n  }\n}];"
      },
      "id": "f6a7b8c9-d0e1-2345-f123-456789012345",
      "name": "ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é‡è¤‡ãƒã‚§ãƒƒã‚¯",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1050,
        300
      ],
      "notes": "æŒ‡å®šæ™‚é–“ã«æ—¢å­˜äºˆå®šãŒã‚ã‚‹ã‹åˆ¤å®š"
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.conflict }}",
              "value2": true
            }
          ]
        }
      },
      "id": "a7b8c9d0-e1f2-3456-1234-567890123456",
      "name": "æ¡ä»¶åˆ†å²ï¼ˆé‡è¤‡ã‚ã‚Š/ãªã—ï¼‰",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1250,
        300
      ],
      "notes": "é‡è¤‡ã®æœ‰ç„¡ã§å‡¦ç†ã‚’åˆ†å²"
    },
    {
      "parameters": {
        "calendar": "primary",
        "operation": "create",
        "start": "={{ $json.date }}T{{ $json.start_time }}:00+09:00",
        "end": "={{ $json.date }}T{{ $json.end_time }}:00+09:00",
        "summary": "={{ $json.title }}",
        "options": {
          "attendees": "={{ $json.participants_with_email.map(p => p.email).join(',') }}",
          "conferenceData": "hangoutsMeet",
          "description": "Discordã‹ã‚‰è‡ªå‹•ä½œæˆã•ã‚ŒãŸäºˆå®š",
          "sendUpdates": "all"
        }
      },
      "id": "b8c9d0e1-f2a3-4567-2345-678901234567",
      "name": "[é‡è¤‡ãªã—] Google Calendar äºˆå®šè¿½åŠ ",
      "type": "n8n-nodes-base.googleCalendar",
      "typeVersion": 1,
      "position": [
        1450,
        150
      ],
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "3",
          "name": "Google Calendar API"
        }
      },
      "onError": "continueErrorOutput",
      "retryOnFail": true,
      "maxTries": 3,
      "waitBetweenTries": 5000,
      "notes": "é‡è¤‡ãªã—ãƒ«ãƒ¼ãƒˆ: äºˆå®šã‚’å³åº§ã«ä½œæˆï¼ˆGoogle Meetè‡ªå‹•ç”Ÿæˆï¼‰"
    },
    {
      "parameters": {
        "content": "âœ… **äºˆå®šã‚’è¿½åŠ ã—ã¾ã—ãŸ**\n\nğŸ“… æ—¥æ™‚: {{ $json.date }} {{ $json.start_time }}-{{ $json.end_time }}\nğŸ“ ã‚¿ã‚¤ãƒˆãƒ«: {{ $json.title }}\nğŸ‘¥ å‚åŠ è€…: {{ $json.participants_with_email.map(p => p.name).join(', ') }}\nğŸ”— Google Meet: {{ $json.hangoutLink }}\n\nå‚åŠ è€…ã«ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã™...",
        "options": {}
      },
      "id": "c9d0e1f2-a3b4-5678-3456-789012345678",
      "name": "[é‡è¤‡ãªã—] Discord å³åº§æˆåŠŸé€šçŸ¥",
      "type": "n8n-nodes-base.discord",
      "typeVersion": 1,
      "position": [
        1650,
        150
      ],
      "credentials": {
        "discordWebhookApi": {
          "id": "4",
          "name": "Discord Webhook URL"
        }
      },
      "retryOnFail": true,
      "maxTries": 2,
      "waitBetweenTries": 3000,
      "notes": "é‡è¤‡ãªã—ãƒ«ãƒ¼ãƒˆ: æˆåŠŸã‚’Discordã«å³åº§é€šçŸ¥"
    },
    {
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "// ç©ºãæ™‚é–“å€™è£œç”Ÿæˆï¼ˆAIå‡¦ç†ï¼‰\n\nconst data = $input.first().json;\nconst existingEvents = data.existing_events || [];\nconst requestedDate = data.date;\nconst durationMinutes = (\n  new Date(`${requestedDate}T${data.end_time}`) - \n  new Date(`${requestedDate}T${data.start_time}`)\n) / 60000;\n\n// å–¶æ¥­æ™‚é–“: 11:00-22:00\nconst workStart = 11;\nconst workEnd = 22;\n\n// ãã®æ—¥ã®ç©ºãæ™‚é–“ã‚’å–å¾—\nconst today = new Date(requestedDate);\nconst todaySlots = findFreeSlots(today, existingEvents, workStart, workEnd, durationMinutes);\n\n// ç¿Œæ—¥ã®ç©ºãæ™‚é–“ã‚’å–å¾—\nconst tomorrow = new Date(today);\ntomorrow.setDate(tomorrow.getDate() + 1);\nconst tomorrowSlots = findFreeSlots(tomorrow, existingEvents, workStart, workEnd, durationMinutes);\n\n// 5å€™è£œã‚’é¸å®šï¼ˆä»Šæ—¥3ã¤ + æ˜æ—¥2ã¤ï¼‰\nconst candidates = [\n  ...todaySlots.slice(0, 3).map((slot, i) => ({\n    option_number: i + 1,\n    date: formatDate(slot.start),\n    start_time: formatTime(slot.start),\n    end_time: formatTime(slot.end),\n    label: `ä»Šæ—¥ ${formatTime(slot.start)}-${formatTime(slot.end)}`\n  })),\n  ...tomorrowSlots.slice(0, 2).map((slot, i) => ({\n    option_number: i + 4,\n    date: formatDate(slot.start),\n    start_time: formatTime(slot.start),\n    end_time: formatTime(slot.end),\n    label: `æ˜æ—¥ ${formatTime(slot.start)}-${formatTime(slot.end)}`\n  }))\n];\n\nfunction findFreeSlots(date, events, startHour, endHour, duration) {\n  const slots = [];\n  const dateStr = formatDate(date);\n  \n  for (let hour = startHour; hour < endHour; hour++) {\n    for (let minute = 0; minute < 60; minute += 30) {\n      const slotStart = new Date(`${dateStr}T${String(hour).padStart(2, '0')}:${String(minute).padStart(2, '0')}:00+09:00`);\n      const slotEnd = new Date(slotStart.getTime() + duration * 60000);\n      \n      if (slotEnd.getHours() > endHour || (slotEnd.getHours() === endHour && slotEnd.getMinutes() > 0)) {\n        break;\n      }\n      \n      // æ—¢å­˜äºˆå®šã¨é‡è¤‡ã—ã¦ã„ãªã„ã‹ç¢ºèª\n      const hasConflict = events.some(event => {\n        if (!event.start || !event.end) return false;\n        const eventStart = new Date(event.start.dateTime || event.start.date);\n        const eventEnd = new Date(event.end.dateTime || event.end.date);\n        return slotStart < eventEnd && slotEnd > eventStart;\n      });\n      \n      if (!hasConflict) {\n        slots.push({ start: slotStart, end: slotEnd });\n      }\n    }\n  }\n  \n  return slots;\n}\n\nfunction formatDate(date) {\n  return date.toISOString().split('T')[0];\n}\n\nfunction formatTime(date) {\n  return date.toTimeString().slice(0, 5);\n}\n\nreturn [{\n  json: {\n    ...data,\n    candidates: candidates\n  }\n}];"
      },
      "id": "d0e1f2a3-b4c5-6789-4567-890123456789",
      "name": "[é‡è¤‡ã‚ã‚Š] ç©ºãæ™‚é–“å€™è£œç”Ÿæˆï¼ˆAIï¼‰",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1450,
        450
      ],
      "notes": "ã€AIã€‘å–¶æ¥­æ™‚é–“å†…ï¼ˆ11:00-22:00ï¼‰ã®ç©ºãæ™‚é–“ã‹ã‚‰5å€™è£œã‚’ç”Ÿæˆ\nä»Šæ—¥3ã¤ + æ˜æ—¥2ã¤"
    },
    {
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "// Discordå€™è£œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆï¼ˆAIå‡¦ç†ï¼‰\n\nconst data = $input.first().json;\nconst candidates = data.candidates || [];\n\nlet message = `âš ï¸ **æŒ‡å®šæ™‚é–“ã«äºˆå®šãŒã‚ã‚Šã¾ã™**\n\nä»¥ä¸‹ã®å€™è£œã‹ã‚‰é¸æŠã—ã¦ãã ã•ã„ï¼š\n\n`;\n\ncandidates.forEach(c => {\n  message += `${c.option_number}ï¸âƒ£ ${c.label}\\n`;\n});\n\nmessage += `\n**ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„**ï¼ˆä¾‹: 1 ã¾ãŸã¯ â‘ ï¼‰\nâ±ï¸ 5åˆ†ä»¥å†…ã«è¿”ä¿¡ãŒãªã„å ´åˆã¯ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã™ã€‚`;\n\nreturn [{\n  json: {\n    ...data,\n    discord_message: message\n  }\n}];"
      },
      "id": "e1f2a3b4-c5d6-7890-5678-901234567890",
      "name": "[é‡è¤‡ã‚ã‚Š] Discord å€™è£œæç¤ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆï¼ˆAIï¼‰",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1650,
        450
      ],
      "notes": "ã€AIã€‘å€™è£œã‚’è¦‹ã‚„ã™ã„ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§Discordãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ"
    },
    {
      "parameters": {
        "content": "={{ $json.discord_message }}",
        "options": {}
      },
      "id": "f2a3b4c5-d6e7-8901-6789-012345678901",
      "name": "[é‡è¤‡ã‚ã‚Š] Discord å€™è£œæç¤º",
      "type": "n8n-nodes-base.discord",
      "typeVersion": 1,
      "position": [
        1850,
        450
      ],
      "credentials": {
        "discordWebhookApi": {
          "id": "4",
          "name": "Discord Webhook URL"
        }
      },
      "retryOnFail": true,
      "maxTries": 2,
      "waitBetweenTries": 3000,
      "notes": "é‡è¤‡ã‚ã‚Šãƒ«ãƒ¼ãƒˆ: å€™è£œã‚’Discordã«é€ä¿¡"
    },
    {
      "parameters": {
        "resume": "webhook",
        "options": {
          "maxWaitTime": 300
        }
      },
      "id": "a3b4c5d6-e7f8-9012-7890-123456789012",
      "name": "[é‡è¤‡ã‚ã‚Š] ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠå¾…æ©Ÿ",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1,
      "position": [
        2050,
        450
      ],
      "webhookId": "user-selection-webhook",
      "credentials": {
        "httpHeaderAuth": {
          "id": "5",
          "name": "Wait Webhookèªè¨¼"
        }
      },
      "notes": "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®é¸æŠã‚’æœ€å¤§5åˆ†é–“å¾…æ©Ÿ"
    },
    {
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "// é¸æŠå†…å®¹ãƒ‘ãƒ¼ã‚¹ï¼ˆAIå‡¦ç†ï¼‰\n\nconst previousData = $input.item(0).json;\nconst userResponse = $input.item(1).json;\nconst candidates = previousData.candidates || [];\n\nconst userMessage = userResponse.message || userResponse.content || '';\n\n// AIå‡¦ç†: å¤šæ§˜ãªè¡¨ç¾ã‹ã‚‰é¸æŠã‚’æŠ½å‡º\n// ã€Œâ‘ ã€ã€Œ1ã€ã€Œä¸€ç•ªç›®ã€ã€Œæœ€åˆã€ãªã©ã«å¯¾å¿œ\n\nlet selectedNumber = null;\n\n// æ•°å­—ã‚’æŠ½å‡º\nconst numberMatch = userMessage.match(/[â‘ â‘¡â‘¢â‘£â‘¤12345ä¸€äºŒä¸‰å››äº”]/g);\nif (numberMatch) {\n  const numStr = numberMatch[0];\n  const numMap = {\n    'â‘ ': 1, '1': 1, 'ä¸€': 1,\n    'â‘¡': 2, '2': 2, 'äºŒ': 2,\n    'â‘¢': 3, '3': 3, 'ä¸‰': 3,\n    'â‘£': 4, '4': 4, 'å››': 4,\n    'â‘¤': 5, '5': 5, 'äº”': 5\n  };\n  selectedNumber = numMap[numStr];\n}\n\nif (!selectedNumber) {\n  throw new Error('é¸æŠã‚’èªè­˜ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');\n}\n\nconst selectedCandidate = candidates.find(c => c.option_number === selectedNumber);\n\nif (!selectedCandidate) {\n  throw new Error('ç„¡åŠ¹ãªé¸æŠã§ã™ã€‚1-5ã®ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');\n}\n\nreturn [{\n  json: {\n    ...previousData,\n    selected_candidate: selectedCandidate,\n    user_selection: selectedNumber\n  }\n}];"
      },
      "id": "b4c5d6e7-f8a9-0123-8901-234567890123",
      "name": "[é‡è¤‡ã‚ã‚Š] é¸æŠå†…å®¹ãƒ‘ãƒ¼ã‚¹ï¼ˆAIï¼‰",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2250,
        450
      ],
      "onError": "continueErrorOutput",
      "notes": "ã€AIã€‘ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¿”ä¿¡ã‹ã‚‰é¸æŠã•ã‚ŒãŸå€™è£œã‚’ç‰¹å®š\nå¤šæ§˜ãªè¡¨ç¾ã«å¯¾å¿œ"
    },
    {
      "parameters": {
        "calendar": "primary",
        "operation": "create",
        "start": "={{ $json.selected_candidate.date }}T{{ $json.selected_candidate.start_time }}:00+09:00",
        "end": "={{ $json.selected_candidate.date }}T{{ $json.selected_candidate.end_time }}:00+09:00",
        "summary": "={{ $json.title }}",
        "options": {
          "attendees": "={{ $json.participants_with_email.map(p => p.email).join(',') }}",
          "conferenceData": "hangoutsMeet",
          "description": "Discordã‹ã‚‰è‡ªå‹•ä½œæˆã•ã‚ŒãŸäºˆå®šï¼ˆä»£æ›¿æ™‚é–“ï¼‰",
          "sendUpdates": "all"
        }
      },
      "id": "c5d6e7f8-a9b0-1234-9012-345678901234",
      "name": "[é‡è¤‡ã‚ã‚Š] Google Calendar äºˆå®šè¿½åŠ ",
      "type": "n8n-nodes-base.googleCalendar",
      "typeVersion": 1,
      "position": [
        2450,
        450
      ],
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "3",
          "name": "Google Calendar API"
        }
      },
      "onError": "continueErrorOutput",
      "retryOnFail": true,
      "maxTries": 3,
      "waitBetweenTries": 5000,
      "notes": "é‡è¤‡ã‚ã‚Šãƒ«ãƒ¼ãƒˆ: é¸æŠã•ã‚ŒãŸæ™‚é–“ã§äºˆå®šã‚’ä½œæˆ"
    },
    {
      "parameters": {
        "mode": "append",
        "combineBy": "combineAll"
      },
      "id": "d6e7f8a9-b0c1-2345-0123-456789012345",
      "name": "åˆ†å²çµ±åˆï¼ˆMergeï¼‰",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2.1,
      "position": [
        2650,
        300
      ],
      "notes": "é‡è¤‡ã‚ã‚Š/ãªã—ä¸¡æ–¹ã®ãƒ–ãƒ©ãƒ³ãƒã‚’çµ±åˆ"
    },
    {
      "parameters": {
        "batchSize": 1,
        "options": {}
      },
      "id": "e7f8a9b0-c1d2-3456-1234-567890123456",
      "name": "å‚åŠ è€…ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãƒ«ãƒ¼ãƒ—æº–å‚™",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        2850,
        300
      ],
      "notes": "å‚åŠ è€…ãƒªã‚¹ãƒˆã‚’1ä»¶ãšã¤å‡¦ç†"
    },
    {
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "// ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ç”Ÿæˆï¼ˆAIå‡¦ç†ï¼‰\n\nconst eventData = $input.first().json;\nconst participant = eventData.participants_with_email?.[0] || {};\n\nconst subject = `ã€äºˆå®šè¿½åŠ ã€‘${eventData.title || 'æ–°ã—ã„äºˆå®š'}`;\n\nconst body = `\n<html>\n<body style=\"font-family: sans-serif; line-height: 1.6;\">\n<h2>ğŸ“… äºˆå®šãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸ</h2>\n\n<p>${participant.name} æ§˜</p>\n\n<p>ä»¥ä¸‹ã®äºˆå®šãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸï¼š</p>\n\n<table style=\"border-collapse: collapse; width: 100%; margin: 20px 0;\">\n<tr style=\"background-color: #f0f0f0;\">\n  <td style=\"padding: 10px; border: 1px solid #ddd; width: 120px;\"><strong>æ—¥æ™‚</strong></td>\n  <td style=\"padding: 10px; border: 1px solid #ddd;\">${eventData.selected_candidate?.date || eventData.date} ${eventData.selected_candidate?.start_time || eventData.start_time}-${eventData.selected_candidate?.end_time || eventData.end_time}</td>\n</tr>\n<tr>\n  <td style=\"padding: 10px; border: 1px solid #ddd;\"><strong>ã‚¿ã‚¤ãƒˆãƒ«</strong></td>\n  <td style=\"padding: 10px; border: 1px solid #ddd;\">${eventData.title}</td>\n</tr>\n<tr style=\"background-color: #f0f0f0;\">\n  <td style=\"padding: 10px; border: 1px solid #ddd;\"><strong>å‚åŠ è€…</strong></td>\n  <td style=\"padding: 10px; border: 1px solid #ddd;\">${eventData.participants_with_email?.map(p => p.name).join(', ')}</td>\n</tr>\n<tr>\n  <td style=\"padding: 10px; border: 1px solid #ddd;\"><strong>Google Meet</strong></td>\n  <td style=\"padding: 10px; border: 1px solid #ddd;\"><a href=\"${eventData.hangoutLink}\">${eventData.hangoutLink}</a></td>\n</tr>\n</table>\n\n<p>ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«è‡ªå‹•è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>\n\n<hr style=\"margin: 30px 0;\">\n<p style=\"color: #666; font-size: 0.9em;\">ã“ã®ãƒ¡ãƒ¼ãƒ«ã¯è‡ªå‹•é€ä¿¡ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>\n</body>\n</html>\n`;\n\nreturn [{\n  json: {\n    to: participant.email,\n    subject: subject,\n    body: body,\n    participant_name: participant.name\n  }\n}];"
      },
      "id": "f8a9b0c1-d2e3-4567-2345-678901234567",
      "name": "Gmail é€šçŸ¥ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ç”Ÿæˆï¼ˆAIï¼‰",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3050,
        300
      ],
      "notes": "ã€AIã€‘äºˆå®šæƒ…å ±ã‹ã‚‰è¦‹ã‚„ã™ã„ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ã‚’ç”Ÿæˆ"
    },
    {
      "parameters": {
        "sendTo": "={{ $json.to }}",
        "subject": "={{ $json.subject }}",
        "emailType": "html",
        "message": "={{ $json.body }}",
        "options": {}
      },
      "id": "a9b0c1d2-e3f4-5678-3456-789012345678",
      "name": "Gmail é€šçŸ¥ãƒ¡ãƒ¼ãƒ«é€ä¿¡",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        3250,
        300
      ],
      "credentials": {
        "gmailOAuth2": {
          "id": "6",
          "name": "Gmail API"
        }
      },
      "retryOnFail": true,
      "maxTries": 2,
      "waitBetweenTries": 3000,
      "notes": "å„å‚åŠ è€…ã«äºˆå®šè©³ç´°ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡"
    },
    {
      "parameters": {
        "content": "âœ… **å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ**\n\nğŸ“… äºˆå®šã‚’è¿½åŠ ã—ã€å‚åŠ è€…ã«ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚\n\n**äºˆå®šè©³ç´°:**\næ—¥æ™‚: {{ $json.selected_candidate?.date || $json.date }} {{ $json.selected_candidate?.start_time || $json.start_time }}-{{ $json.selected_candidate?.end_time || $json.end_time }}\nã‚¿ã‚¤ãƒˆãƒ«: {{ $json.title }}\nå‚åŠ è€…: {{ $json.participants_with_email?.map(p => p.name).join(', ') }}",
        "options": {}
      },
      "id": "b0c1d2e3-f4a5-6789-4567-890123456789",
      "name": "Discord æœ€çµ‚çµæœå ±å‘Š",
      "type": "n8n-nodes-base.discord",
      "typeVersion": 1,
      "position": [
        3450,
        300
      ],
      "credentials": {
        "discordWebhookApi": {
          "id": "4",
          "name": "Discord Webhook URL"
        }
      },
      "retryOnFail": true,
      "maxTries": 2,
      "waitBetweenTries": 3000,
      "notes": "å‡¦ç†å®Œäº†ã‚’Discordã«é€šçŸ¥"
    }
  ],
  "connections": {
    "Discord ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡": {
      "main": [
        [
          {
            "node": "Notion å‚åŠ è€…ãƒã‚¹ã‚¿ãƒ¼å–å¾—",
            "type": "main",
            "index": 0
          },
          {
            "node": "è‡ªç„¶è¨€èªãƒ‘ãƒ¼ã‚¹ï¼ˆAIï¼‰",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notion å‚åŠ è€…ãƒã‚¹ã‚¿ãƒ¼å–å¾—": {
      "main": [
        [
          {
            "node": "å‚åŠ è€…åâ†’ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å¤‰æ›ï¼ˆAIï¼‰",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è‡ªç„¶è¨€èªãƒ‘ãƒ¼ã‚¹ï¼ˆAIï¼‰": {
      "main": [
        [
          {
            "node": "å‚åŠ è€…åâ†’ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å¤‰æ›ï¼ˆAIï¼‰",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "å‚åŠ è€…åâ†’ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å¤‰æ›ï¼ˆAIï¼‰": {
      "main": [
        [
          {
            "node": "Google Calendar æ—¢å­˜äºˆå®šå–å¾—",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Calendar æ—¢å­˜äºˆå®šå–å¾—": {
      "main": [
        [
          {
            "node": "ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é‡è¤‡ãƒã‚§ãƒƒã‚¯",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é‡è¤‡ãƒã‚§ãƒƒã‚¯": {
      "main": [
        [
          {
            "node": "æ¡ä»¶åˆ†å²ï¼ˆé‡è¤‡ã‚ã‚Š/ãªã—ï¼‰",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ¡ä»¶åˆ†å²ï¼ˆé‡è¤‡ã‚ã‚Š/ãªã—ï¼‰": {
      "main": [
        [
          {
            "node": "[é‡è¤‡ãªã—] Google Calendar äºˆå®šè¿½åŠ ",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "[é‡è¤‡ã‚ã‚Š] ç©ºãæ™‚é–“å€™è£œç”Ÿæˆï¼ˆAIï¼‰",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "[é‡è¤‡ãªã—] Google Calendar äºˆå®šè¿½åŠ ": {
      "main": [
        [
          {
            "node": "[é‡è¤‡ãªã—] Discord å³åº§æˆåŠŸé€šçŸ¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "[é‡è¤‡ãªã—] Discord å³åº§æˆåŠŸé€šçŸ¥": {
      "main": [
        [
          {
            "node": "åˆ†å²çµ±åˆï¼ˆMergeï¼‰",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "[é‡è¤‡ã‚ã‚Š] ç©ºãæ™‚é–“å€™è£œç”Ÿæˆï¼ˆAIï¼‰": {
      "main": [
        [
          {
            "node": "[é‡è¤‡ã‚ã‚Š] Discord å€™è£œæç¤ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆï¼ˆAIï¼‰",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "[é‡è¤‡ã‚ã‚Š] Discord å€™è£œæç¤ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆï¼ˆAIï¼‰": {
      "main": [
        [
          {
            "node": "[é‡è¤‡ã‚ã‚Š] Discord å€™è£œæç¤º",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "[é‡è¤‡ã‚ã‚Š] Discord å€™è£œæç¤º": {
      "main": [
        [
          {
            "node": "[é‡è¤‡ã‚ã‚Š] ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠå¾…æ©Ÿ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "[é‡è¤‡ã‚ã‚Š] ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠå¾…æ©Ÿ": {
      "main": [
        [
          {
            "node": "[é‡è¤‡ã‚ã‚Š] é¸æŠå†…å®¹ãƒ‘ãƒ¼ã‚¹ï¼ˆAIï¼‰",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "[é‡è¤‡ã‚ã‚Š] é¸æŠå†…å®¹ãƒ‘ãƒ¼ã‚¹ï¼ˆAIï¼‰": {
      "main": [
        [
          {
            "node": "[é‡è¤‡ã‚ã‚Š] Google Calendar äºˆå®šè¿½åŠ ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "[é‡è¤‡ã‚ã‚Š] Google Calendar äºˆå®šè¿½åŠ ": {
      "main": [
        [
          {
            "node": "åˆ†å²çµ±åˆï¼ˆMergeï¼‰",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "åˆ†å²çµ±åˆï¼ˆMergeï¼‰": {
      "main": [
        [
          {
            "node": "å‚åŠ è€…ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãƒ«ãƒ¼ãƒ—æº–å‚™",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å‚åŠ è€…ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãƒ«ãƒ¼ãƒ—æº–å‚™": {
      "main": [
        [
          {
            "node": "Gmail é€šçŸ¥ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ç”Ÿæˆï¼ˆAIï¼‰",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gmail é€šçŸ¥ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ç”Ÿæˆï¼ˆAIï¼‰": {
      "main": [
        [
          {
            "node": "Gmail é€šçŸ¥ãƒ¡ãƒ¼ãƒ«é€ä¿¡",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gmail é€šçŸ¥ãƒ¡ãƒ¼ãƒ«é€ä¿¡": {
      "main": [
        [
          {
            "node": "å‚åŠ è€…ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãƒ«ãƒ¼ãƒ—æº–å‚™",
            "type": "main",
            "index": 0
          },
          {
            "node": "Discord æœ€çµ‚çµæœå ±å‘Š",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "saveExecutionProgress": true,
    "timezone": "Asia/Tokyo"
  },
  "staticData": null,
  "tags": [
    "äºˆå®šç®¡ç†",
    "Discord",
    "è‡ªå‹•åŒ–",
    "AI"
  ],
  "pinData": {},
  "versionId": "workflow-v1-20251107"
}