# n8nワークフロー自動設計プロセス v4.0 - プロンプト集

## 概要

このディレクトリには、n8nワークフロー自動設計プロセス v4.0 の全ステッププロンプトが含まれています。各プロンプトは、ユーザーから業務要件を段階的に引き出し、n8nにインポート可能な完全なワークフローJSONを自動生成します。

## プロセス全体構造

```
Phase 1: 要件定義・設計 (Step010-060)
├─ Step010: 業務理解（12要素ヒアリング）
├─ Step020: AI設定（業務要件ベース）
├─ Step030: 技術要件変換（12層フレームワーク）
├─ Step040: タスク分解とグループ化
├─ Step050: AIエージェント責務定義
└─ Step060: パターン適用と詳細設計

Phase 2: グループ別JSON生成 (Step070-149)
├─ メインフローグループ (Step070-129)
│   ├─ Group 1: Step070(JSON生成) + Step071(配置調整)
│   ├─ Group 2: Step072(JSON生成) + Step073(配置調整)
│   ├─ ...
│   └─ Group 30: Step128(JSON生成) + Step129(配置調整)
│
└─ エラーフローグループ (Step130-149)
    ├─ Error Group 1: Step130(JSON生成) + Step131(配置調整)
    ├─ Error Group 2: Step132(JSON生成) + Step133(配置調整)
    ├─ ...
    └─ Error Group 10: Step148(JSON生成) + Step149(配置調整)

Phase 3: 統合・検証・出力 (Step150-190)
├─ Step150: グループ間接続統合
├─ Step160: ワークフロー全体検証
├─ Step170: 配置最適化
├─ Step180: Sticky Note完成
└─ Step190: 最終出力
```

## プロンプトファイル一覧

### Phase 1: 要件定義・設計

| ファイル名 | ステップ | 目的 |
|-----------|---------|------|
| `step010-業務理解.md` | Step010 | 12要素フレームワークによる業務要件収集 |
| `step020-AI設定.md` | Step020 | 業務要件に基づく最適AIモデル選定 |
| `step030-技術要件変換.md` | Step030 | 12層アーキテクチャへの技術要件変換 |
| `step040-タスク分解とグループ化.md` | Step040 | グループ単位へのタスク分解 |
| `step050-AIエージェント責務定義.md` | Step050 | 単一責務の原則に基づくAI責務定義 |
| `step060-パターン適用と詳細設計.md` | Step060 | ベストプラクティスパターン適用 |

### Phase 2: グループ別JSON生成

| ファイル名 | ステップ | 目的 |
|-----------|---------|------|
| `step070-メインフローグループJSON生成テンプレート.md` | Step070-129 | メインフローグループのJSON生成テンプレート |

**使用方法**:
- このテンプレートを各グループ（Group 1-30）に適用
- `[N]` を具体的な数値（1, 2, 3, ...）に置換
- Step060の詳細設計書から該当グループの情報を抽出
- トークン最適化（1グループ=2500トークン以下）を維持

### Phase 3: 統合・検証・出力

| ファイル名 | ステップ | 目的 |
|-----------|---------|------|
| `step150-グループ間接続統合.md` | Step150 | 全グループを1つのワークフローJSONに統合 |
| `step160-ワークフロー全体検証.md` | Step160 | 統合ワークフローの包括的検証 |
| `step170-配置最適化.md` | Step170 | ノードの視覚的配置最適化 |
| `step180-StickyNote完成.md` | Step180 | Sticky Note（非白色・ノードブロック付き）の詳細説明追加 |
| `step190-最終出力.md` | Step190 | 完全実装パッケージの出力 |

### Sticky Note設計ポリシー（Step180補足）

**改良版v4.1: 視覚的整列配置とグループ色分け**（2025-11-12更新）

- **パターン1（全体フロー）**: 最低760×650で全文表示し、色7（薄ピンク）固定。`### 🔗 関連ノードブロック` で全ノードの役割と接続をブロック化する
  - 配置: (100, 50) - 上部に横長配置
  - 整列: 横一列配置（ノード間隔300px）

- **パターン2（各グループ）**: 最低540×420で全文表示
  - **色分けルール拡張**（画像対応）:
    - 色2（薄緑）: データ収集・入力グループ
    - 色3（薄青）: データ変換・処理グループ
    - 色4（薄紫）: AI処理・分析グループ
    - 色6（薄オレンジ）: 出力・通知グループ
    - 色5（薄赤）: エラーフローグループ
    - 色0/1（白/黄）: 使用禁止
  - **整列パターン**: 縦一列配置（ノード間隔180px、同一X座標）
  - **グループ間隔**: 水平500px、垂直500px
  - **サイズ自動調整**: calculateStickyDimensionsで算出
  - **色自動選択**: selectGroupColorで決定

- すべてのSticky Noteで所属ノードのレイヤー・前後関係・主要データが視覚的に把握できるMarkdown構造を維持する

### 視覚的整列配置の改良点（v4.1）

1. **グループ整列パターン**（Step170, Step060で詳細化）:
   - 横一列配置: 全体フロー
   - 縦一列配置: 各グループ（推奨）
   - グリッド配置: 複雑なグループ

2. **グループ間分離戦略**（Step170で詳細化）:
   - 水平分離: グループ間隔500px
   - 垂直分離: グループ間隔500px
   - ハイブリッド分離: 2×2グリッド等

3. **Sticky Note視覚的包含**（Step170で詳細化）:
   - 各グループの左上に配置（基準座標から左50px、上50px）
   - グループ全体を包含するサイズに自動調整
   - マージン: 上50px、左50px、右50px、下50px

## 使用方法

### 1. 新規ワークフロー設計の開始

1. **Step010から順番に実行**:
   ```bash
   # Step010の実行
   Claude Code に step010-業務理解.md のプロンプトを提示
   → ユーザーから12要素をヒアリング
   → 業務理解書を出力
   ```

2. **各ステップの成果物を確認**:
   - 各ステップ完了後、ユーザーに確認を求める
   - 承認後、次ステップへ進む
   - 成果物は `./{業務目的}/step{番号}_{ステップ名}/` に保存

3. **Phase 1完了後、Phase 2へ移行**:
   - Step060完了後、グループ数を確認
   - Step070テンプレートを各グループに適用

4. **Phase 2完了後、Phase 3へ移行**:
   - Step150でグループ間接続統合
   - Step190で最終出力

### 2. テンプレートの使用方法（Phase 2）

**例: Group 1のJSON生成**

1. `step070-メインフローグループJSON生成テンプレート.md` をコピー
2. `[N]` を `1` に置換
3. `[グループ名]` を `データ受信・初期化` に置換
4. Step060の詳細設計書からGroup 1の情報を抽出
5. プロンプトを実行してJSON生成

**例: Group 2のJSON生成**

1. 同じテンプレートを使用
2. `[N]` を `2` に置換
3. `[グループ名]` を `入力検証・前処理` に置換
4. Step060の詳細設計書からGroup 2の情報を抽出
5. プロンプトを実行してJSON生成

### 3. 各フェーズの推奨実行時間

| フェーズ | ステップ数 | 推定時間 | 備考 |
|---------|----------|---------|------|
| Phase 1 | 6ステップ | 2-3時間 | ヒアリング・設計に時間をかける |
| Phase 2 | グループ数×2 | 1-2時間 | グループ数により変動 |
| Phase 3 | 5ステップ | 30分-1時間 | 統合・検証・出力 |

## ディレクトリ構造（成果物）

プロセス実行後、以下のディレクトリ構造が作成されます:

```
./{業務目的}/
├── step010_業務理解/
│   └── 業務理解書.md
├── step020_AI設定/
│   └── AI設定書.md
├── step030_技術要件変換/
│   └── 技術要件書.md
├── step040_タスク分解/
│   └── グループ構成表.md
├── step050_AIエージェント責務/
│   └── AIエージェント責務定義書.md
├── step060_パターン適用/
│   └── 詳細設計書.md
├── step070_Group1_JSON/
│   └── Group1_データ受信初期化.json
├── step072_Group2_JSON/
│   └── Group2_入力検証前処理.json
├── ...
├── step150_統合JSON/
│   └── 統合ワークフロー.json
└── step190_最終成果物/
    ├── README.md
    ├── {業務目的}_workflow_integrated_v4.json
    ├── {業務目的}_metadata_v4.json
    ├── 実装手順書.md
    └── 検証レポート.md
```

## プロンプト設計の原則

### 1. 出力制約の統一

すべてのプロンプトで、以下の出力制約を適用:
- 各ステップ完了後にユーザーに確認を求める
- 承認後に次ステップへ進む
- 成果物を指定ディレクトリに格納

### 2. フォーマットの統一

すべてのプロンプトで、以下のフォーマットを使用:

```markdown
# 目的
[ステップの目的]

# 背景
[このステップがなぜ重要か]

# 言葉の定義
[ユーザー独自の用語定義]

# 制約
[出力制約、技術制約など]

# 処理手順
## 処理手順の全体フロー
[Mermaid図など]

## 処理手順1-N
[詳細手順]

# 初回質問
[ユーザーに最初に尋ねる質問]
```

### 3. エージェント名の明示

各処理手順に、以下を明記:
- **エージェント名**: 実在する書籍になっている人物・フレームワーク
- **役割**: 手順における具体的な役割
- **責務**: エージェントの具体的な責務

### 4. 評価・判断基準の明確化

各処理手順に、成功基準を明記:
- 定量的基準（ノード数、トークン数など）
- 定性的基準（完全性、一貫性など）

### 5. Sticky Note共通要件

- `nodes` コードブロックに「ノード名 (ノードタイプ / Node ID)」形式で所属ノードを列挙する
- `calculateStickyDimensions()` などのロジックで幅・高さを自動算出し、スクロールなしで全文表示
- color=0/1（白/黄）は使用禁止。メインフロー=色6、エラーフロー=色5、全体フロー=色7というコントラストを維持

## トラブルシューティング

### Q1. グループ数が30を超える場合

**対処法**:
- Step040で再設計し、グループを統合
- または、ワークフローを複数に分割

### Q2. トークン数が2500を超える場合

**対処法**:
- グループサイズを縮小（5-15ノード → 3-5ノード）
- パラメータ設定を簡素化

### Q3. n8n-MCP検証でエラーが出る場合

**対処法**:
- エラーメッセージを確認
- Step060の詳細設計を修正
- 再度JSON生成

## 参考資料

### v4.0設計ドキュメント

- 元の設計書（ユーザー提供）: `/Users/dm/.claude/agents/プロンプト - n8nワークフロー自動設計v12(Sticky Noteにノード名を記述).md`
- 12層アーキテクチャ: Step030プロンプト参照
- 12要素フレームワーク: Step010プロンプト参照
- ベストプラクティスパターン: Step060プロンプト参照

### n8n公式ドキュメント

- n8n Docs: https://docs.n8n.io/
- AI Agent Node: https://docs.n8n.io/integrations/builtin/cluster-nodes/sub-nodes/n8n-nodes-langchain.agent/
- n8n-MCP サーバー: プロジェクト内のナレッジドキュメント参照

## ライセンス

このプロンプト集は、n8nワークフロー自動設計プロセス v4.0 の一部として提供されます。

## 作成情報

- **作成日**: 2025-11-10
- **作成者**: Claude Code (Anthropic)
- **バージョン**: v4.0
- **プロンプト数**: 11個（Phase 1: 6個、Phase 2: 1個テンプレート、Phase 3: 5個）
