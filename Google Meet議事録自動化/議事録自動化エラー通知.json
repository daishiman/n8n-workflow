{
  "name": "ã€ã‚¨ãƒ©ãƒ¼ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã€‘è­°äº‹éŒ²è‡ªå‹•åŒ–ã‚¨ãƒ©ãƒ¼é€šçŸ¥",
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.errorTrigger",
      "typeVersion": 1,
      "position": [0, 0],
      "id": "error-trigger",
      "name": "ğŸš¨ ã‚¨ãƒ©ãƒ¼ãƒˆãƒªã‚¬ãƒ¼",
      "notes": "ãƒ¡ã‚¤ãƒ³ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã«è‡ªå‹•å®Ÿè¡Œ"
    },
    {
      "parameters": {
        "jsCode": "// ã‚¨ãƒ©ãƒ¼æƒ…å ±ã®æ•´å½¢ã¨åˆ†æ\nconst items = $input.all();\nconst analyzed = [];\n\nfor (const item of items) {\n  const error = item.json.error || {};\n  const execution = item.json.execution || {};\n  const workflow = item.json.workflow || {};\n\n  // ã‚¨ãƒ©ãƒ¼ã®é‡è¦åº¦åˆ¤å®š\n  let severity = 'warning';\n  const errorMessage = error.message || '';\n  \n  if (errorMessage.includes('èªè¨¼') || errorMessage.includes('credential')) {\n    severity = 'critical';\n  } else if (errorMessage.includes('ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ') || errorMessage.includes('timeout')) {\n    severity = 'warning';\n  } else if (errorMessage.includes('ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼å¤±æ•—')) {\n    severity = 'info';\n  }\n\n  // Slackç”¨ã®çµµæ–‡å­—é¸æŠ\n  const emojiMap = {\n    critical: 'ğŸ”´',\n    warning: 'âš ï¸',\n    info: 'â„¹ï¸'\n  };\n\n  analyzed.push({\n    json: {\n      // åŸºæœ¬æƒ…å ±\n      timestamp: new Date().toISOString(),\n      severity: severity,\n      emoji: emojiMap[severity] || 'âš ï¸',\n      \n      // ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æƒ…å ±\n      workflow_name: workflow.name || 'Unknown',\n      workflow_id: workflow.id || 'Unknown',\n      \n      // å®Ÿè¡Œæƒ…å ±\n      execution_id: execution.id || 'Unknown',\n      execution_mode: execution.mode || 'Unknown',\n      \n      // ã‚¨ãƒ©ãƒ¼æƒ…å ±\n      error_node: error.node || 'Unknown',\n      error_message: errorMessage,\n      error_stack: error.stack || '',\n      \n      // å…¥åŠ›ãƒ‡ãƒ¼ã‚¿æƒ…å ±ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰\n      input_data_summary: {\n        file_name: item.json.file_name || 'Unknown',\n        file_id: item.json.file_id || 'Unknown'\n      },\n      \n      // å†å®Ÿè¡Œç”¨URL\n      execution_url: `https://n8n.example.com/workflow/${workflow.id}/executions/${execution.id}`\n    }\n  });\n}\n\nreturn analyzed;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [200, 0],
      "id": "analyze-error",
      "name": "ğŸ” ã‚¨ãƒ©ãƒ¼åˆ†æ",
      "notes": "ã‚¨ãƒ©ãƒ¼ã®é‡è¦åº¦ã‚’åˆ¤å®šã—ã€æƒ…å ±ã‚’æ•´å½¢"
    },
    {
      "parameters": {
        "webhookUri": "={{ $credentials.webhookUri }}",
        "content": "=ğŸš¨ **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ**",
        "embeds": {
          "values": [
            {
              "title": "={{ $json.emoji }} {{ $json.severity.toUpperCase() }} ã‚¨ãƒ©ãƒ¼",
              "description": "ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ",
              "color": "={{ $json.severity === 'critical' ? 15158332 : ($json.severity === 'warning' ? 16776960 : 3447003) }}",
              "fields": {
                "fields": [
                  {
                    "name": "ğŸ”§ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼",
                    "value": "={{ $json.workflow_name }}",
                    "inline": true
                  },
                  {
                    "name": "âš ï¸ é‡è¦åº¦",
                    "value": "={{ $json.severity }}",
                    "inline": true
                  },
                  {
                    "name": "ğŸ“ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿãƒãƒ¼ãƒ‰",
                    "value": "={{ $json.error_node }}",
                    "inline": false
                  },
                  {
                    "name": "â° ç™ºç”Ÿæ™‚åˆ»",
                    "value": "={{ $json.timestamp }}",
                    "inline": false
                  },
                  {
                    "name": "âŒ ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸",
                    "value": "=```\n{{ $json.error_message.slice(0, 500) }}\n```",
                    "inline": false
                  },
                  {
                    "name": "ğŸ“„ å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«",
                    "value": "={{ $json.input_data_summary.file_name }}",
                    "inline": false
                  },
                  {
                    "name": "ğŸ”— å®Ÿè¡Œå±¥æ­´",
                    "value": "=[å®Ÿè¡Œå±¥æ­´ã‚’ç¢ºèª]({{ $json.execution_url }})",
                    "inline": false
                  }
                ]
              },
              "footer": {
                "text": "n8n Error Handler",
                "iconUrl": "https://n8n.io/favicon.ico"
              },
              "timestamp": "={{ new Date().toISOString() }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [400, 0],
      "id": "notify-discord",
      "name": "ğŸ“¢ Discordã‚¨ãƒ©ãƒ¼é€šçŸ¥",
      "credentials": {
        "discordWebhookApi": {
          "id": "your-discord-webhook-id",
          "name": "Discord Webhook"
        }
      },
      "notes": "ã‚¨ãƒ©ãƒ¼æƒ…å ±ã‚’Discordã«é€šçŸ¥"
    },
    {
      "parameters": {
        "jsCode": "// ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®è¨˜éŒ²ï¼ˆå°†æ¥çš„ã«DBã‚„Notionã«ä¿å­˜ï¼‰\nconst items = $input.all();\nconst logs = [];\n\nfor (const item of items) {\n  logs.push({\n    json: {\n      log_type: 'error',\n      timestamp: new Date().toISOString(),\n      severity: item.json.severity,\n      workflow_info: {\n        name: item.json.workflow_name,\n        id: item.json.workflow_id,\n        execution_id: item.json.execution_id\n      },\n      error_info: {\n        node: item.json.error_node,\n        message: item.json.error_message,\n        stack: item.json.error_stack\n      },\n      input_data: item.json.input_data_summary,\n      notification_sent: true,\n      notification_channel: 'discord'\n    }\n  });\n}\n\nconsole.log('ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°è¨˜éŒ²:', logs);\nreturn logs;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [600, 0],
      "id": "log-error",
      "name": "ğŸ’¾ ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°è¨˜éŒ²",
      "notes": "ã‚¨ãƒ©ãƒ¼å±¥æ­´ã‚’ãƒ­ã‚°ã¨ã—ã¦è¨˜éŒ²"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "critical-check",
              "leftValue": "={{ $json.severity }}",
              "rightValue": "critical",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [800, 0],
      "id": "check-critical",
      "name": "âš ï¸ é‡è¦åº¦ãƒã‚§ãƒƒã‚¯",
      "notes": "Criticalã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã‚‚é€ä¿¡"
    },
    {
      "parameters": {
        "fromEmail": "n8n@example.com",
        "toEmail": "admin@example.com",
        "subject": "=ğŸš¨ ã€ç·Šæ€¥ã€‘ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚¨ãƒ©ãƒ¼: {{ $('ğŸ” ã‚¨ãƒ©ãƒ¼åˆ†æ').item.json.workflow_name }}",
        "emailType": "html",
        "message": "=<h2>ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§é‡å¤§ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h2>\n\n<table>\n  <tr><td><strong>ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼:</strong></td><td>{{ $('ğŸ” ã‚¨ãƒ©ãƒ¼åˆ†æ').item.json.workflow_name }}</td></tr>\n  <tr><td><strong>ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿãƒãƒ¼ãƒ‰:</strong></td><td>{{ $('ğŸ” ã‚¨ãƒ©ãƒ¼åˆ†æ').item.json.error_node }}</td></tr>\n  <tr><td><strong>æ™‚åˆ»:</strong></td><td>{{ $('ğŸ” ã‚¨ãƒ©ãƒ¼åˆ†æ').item.json.timestamp }}</td></tr>\n  <tr><td><strong>é‡è¦åº¦:</strong></td><td>{{ $('ğŸ” ã‚¨ãƒ©ãƒ¼åˆ†æ').item.json.severity }}</td></tr>\n</table>\n\n<h3>ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:</h3>\n<pre>{{ $('ğŸ” ã‚¨ãƒ©ãƒ¼åˆ†æ').item.json.error_message }}</pre>\n\n<p><a href=\"{{ $('ğŸ” ã‚¨ãƒ©ãƒ¼åˆ†æ').item.json.execution_url }}\">å®Ÿè¡Œå±¥æ­´ã‚’ç¢ºèª</a></p>",
        "options": {}
      },
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [1000, -100],
      "id": "send-email",
      "name": "ğŸ“§ ç®¡ç†è€…ãƒ¡ãƒ¼ãƒ«é€šçŸ¥",
      "notes": "Criticalã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯ç®¡ç†è€…ã«ãƒ¡ãƒ¼ãƒ«ã§é€šçŸ¥"
    }
  ],
  "connections": {
    "ğŸš¨ ã‚¨ãƒ©ãƒ¼ãƒˆãƒªã‚¬ãƒ¼": {
      "main": [[{"node": "ğŸ” ã‚¨ãƒ©ãƒ¼åˆ†æ", "type": "main", "index": 0}]]
    },
    "ğŸ” ã‚¨ãƒ©ãƒ¼åˆ†æ": {
      "main": [[{"node": "ğŸ“¢ Discordã‚¨ãƒ©ãƒ¼é€šçŸ¥", "type": "main", "index": 0}]]
    },
    "ğŸ“¢ Discordã‚¨ãƒ©ãƒ¼é€šçŸ¥": {
      "main": [[{"node": "ğŸ’¾ ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°è¨˜éŒ²", "type": "main", "index": 0}]]
    },
    "ğŸ’¾ ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°è¨˜éŒ²": {
      "main": [[{"node": "âš ï¸ é‡è¦åº¦ãƒã‚§ãƒƒã‚¯", "type": "main", "index": 0}]]
    },
    "âš ï¸ é‡è¦åº¦ãƒã‚§ãƒƒã‚¯": {
      "main": [
        [{"node": "ğŸ“§ ç®¡ç†è€…ãƒ¡ãƒ¼ãƒ«é€šçŸ¥", "type": "main", "index": 0}],
        []
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "timezone": "Asia/Tokyo"
  },
  "staticData": null,
  "tags": ["ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°", "é€šçŸ¥"],
  "pinData": {}
}