{
  "name": "DiscordçµŒç”±ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼äºˆå®šè‡ªå‹•ç™»éŒ²ã‚·ã‚¹ãƒ†ãƒ _ErrorHandling",
  "nodes": [
    {
      "parameters": {},
      "id": "error-trigger-001",
      "name": "ã‚¨ãƒ©ãƒ¼ãƒˆãƒªã‚¬ãƒ¼",
      "type": "n8n-nodes-base.errorTrigger",
      "typeVersion": 1,
      "position": [
        250,
        300
      ],
      "notes": "ãƒ¡ã‚¤ãƒ³ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ã‚¨ãƒ©ãƒ¼ã‚’æ¤œçŸ¥"
    },
    {
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "const error = $input.first();\nconst { DateTime } = require('luxon');\n\n// ã‚¨ãƒ©ãƒ¼æƒ…å ±ã‚’æ•´å½¢\nconst errorInfo = {\n  workflow_name: error.json.workflow?.name || 'Unknown',\n  workflow_id: error.json.workflow?.id || 'Unknown',\n  execution_id: error.json.execution?.id || 'Unknown',\n  execution_mode: error.json.execution?.mode || 'Unknown',\n  node_name: error.json.node?.name || 'Unknown',\n  node_type: error.json.node?.type || 'Unknown',\n  error_message: error.json.error?.message || 'Unknown error',\n  error_stack: error.json.error?.stack || '',\n  timestamp: DateTime.now().setZone('Asia/Tokyo').toFormat('yyyy/MM/dd HH:mm:ss'),\n  timestamp_iso: DateTime.now().setZone('Asia/Tokyo').toISO()\n};\n\nreturn [{\n  json: errorInfo\n}];"
      },
      "id": "error-format-002",
      "name": "ã‚¨ãƒ©ãƒ¼æƒ…å ±æ•´å½¢",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        450,
        300
      ],
      "notes": "ã‚¨ãƒ©ãƒ¼æƒ…å ±ã‚’æ§‹é€ åŒ–ã—ã¦æ•´å½¢"
    },
    {
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "const errorInfo = $input.first().json;\n\n// Discordç”¨ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½œæˆ\nconst discordMessage = `ğŸš¨ **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ**\n\n**ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**: ${errorInfo.workflow_name}\n**å®Ÿè¡ŒID**: ${errorInfo.execution_id}\n**ã‚¨ãƒ©ãƒ¼ç®‡æ‰€**: ${errorInfo.node_name} (${errorInfo.node_type})\n**ã‚¨ãƒ©ãƒ¼å†…å®¹**: ${errorInfo.error_message}\n**ç™ºç”Ÿæ™‚åˆ»**: ${errorInfo.timestamp}\n\n---\n**è©³ç´°ã‚¹ã‚¿ãƒƒã‚¯**:\n\\`\\`\\`\n${errorInfo.error_stack.substring(0, 500)}${errorInfo.error_stack.length > 500 ? '...' : ''}\n\\`\\`\\`\n\n**å¯¾å¿œæ–¹æ³•**:\n1. n8nå®Ÿè¡Œå±¥æ­´ã§è©³ç´°ã‚’ç¢ºèª\n2. ã‚¨ãƒ©ãƒ¼ãƒãƒ¼ãƒ‰ã®è¨­å®šã‚’ç¢ºèª\n3. å¿…è¦ã«å¿œã˜ã¦å†å®Ÿè¡Œ`;\n\nreturn [{\n  json: {\n    ...errorInfo,\n    discord_message: discordMessage\n  }\n}];"
      },
      "id": "error-discord-format-003",
      "name": "Discordé€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        650,
        300
      ],
      "notes": "DiscordæŠ•ç¨¿ç”¨ã«ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ•´å½¢"
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "send",
        "webhookUrl": "={{ $env('DISCORD_ERROR_WEBHOOK_URL') }}",
        "content": "={{ $json.discord_message }}"
      },
      "id": "error-discord-send-004",
      "name": "Discordé€šçŸ¥é€ä¿¡",
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [
        850,
        300
      ],
      "onError": "continueErrorOutput",
      "notes": "Discordã«ã‚¨ãƒ©ãƒ¼é€šçŸ¥ã‚’é€ä¿¡"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1",
              "name": "error_logged",
              "value": "true",
              "type": "boolean"
            },
            {
              "id": "2",
              "name": "logged_at",
              "value": "={{ $now.toISO() }}",
              "type": "string"
            },
            {
              "id": "3",
              "name": "workflow_name",
              "value": "={{ $('ã‚¨ãƒ©ãƒ¼æƒ…å ±æ•´å½¢').first().json.workflow_name }}",
              "type": "string"
            },
            {
              "id": "4",
              "name": "error_message",
              "value": "={{ $('ã‚¨ãƒ©ãƒ¼æƒ…å ±æ•´å½¢').first().json.error_message }}",
              "type": "string"
            }
          ]
        }
      },
      "id": "error-log-005",
      "name": "ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°è¨˜éŒ²",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [
        1050,
        300
      ],
      "notes": "ã‚¨ãƒ©ãƒ¼æƒ…å ±ã‚’n8nå®Ÿè¡Œå±¥æ­´ã«è¨˜éŒ²"
    }
  ],
  "connections": {
    "ã‚¨ãƒ©ãƒ¼ãƒˆãƒªã‚¬ãƒ¼": {
      "main": [
        [
          {
            "node": "ã‚¨ãƒ©ãƒ¼æƒ…å ±æ•´å½¢",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ã‚¨ãƒ©ãƒ¼æƒ…å ±æ•´å½¢": {
      "main": [
        [
          {
            "node": "Discordé€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Discordé€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ": {
      "main": [
        [
          {
            "node": "Discordé€šçŸ¥é€ä¿¡",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Discordé€šçŸ¥é€ä¿¡": {
      "main": [
        [
          {
            "node": "ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°è¨˜éŒ²",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "saveExecutionProgress": true,
    "timezone": "Asia/Tokyo"
  },
  "staticData": null,
  "tags": [
    "error-handling",
    "notifications"
  ],
  "pinData": {},
  "versionId": "error-workflow-v1-uuid"
}