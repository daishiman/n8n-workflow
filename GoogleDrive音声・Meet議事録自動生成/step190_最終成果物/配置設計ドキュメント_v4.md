# 配置設計ドキュメント - GoogleDrive音声Meet議事録自動生成システム v4.0

**作成日**: 2025-11-13
**対象ワークフロー**: GoogleDrive音声Meet議事録自動生成_workflow_optimized_v4.json
**ノード総数**: 40ノード
**グループ数**: 9グループ（メインフロー） + 1全体フロー Sticky Note

---

## 配置戦略の概要

### 基本方針

✅ **グループ垂直配置**: すべてのグループは上から下へ依存関係順に配置
✅ **グループ内横一列整列**: 各グループ内のノードは水平方向に300px間隔で展開
✅ **AI階層配置**: AIエージェントのサブノード（Language Model, Memory）は親ノードの下200pxにぶら下げ
✅ **視覚的一貫性**: グループ間隔500px、ノード間隔300pxで統一
✅ **データフロー可視化**: 上から下への一方向データフローを明確に表現

### 配置の利点

1. **可読性**: グループごとに整列し、依存関係が一目で理解できる
2. **保守性**: ノード追加・変更時の影響範囲が明確
3. **スケーラビリティ**: グループ数が増加しても論理的配置が維持される
4. **デバッグ効率**: データフローが視覚的に追跡しやすい

---

## 配置ルール

### グループ配置ルール

| ルール | 値 | 説明 |
|--------|-----|------|
| **基準Y座標** | 100 | 全体フローSticky Noteの下端基準 |
| **グループ間隔（垂直）** | 500px | グループ間の垂直間隔（Sticky Note高さ考慮） |
| **基準X座標** | 100 | すべてのグループで統一（並列グループ以外） |
| **AI階層追加高さ** | 250px | AI Agentサブノードをぶら下げる追加高さ |

### ノード配置ルール

| ルール | 値 | 説明 |
|--------|-----|------|
| **ノード間隔（水平）** | 300px | グループ内ノードの水平間隔 |
| **ノード間隔（垂直）** | 0px | 同一グループ内のノードは同一Y座標（横一列） |
| **AIサブノード垂直オフセット** | 200px | 親AI Agentノードから下方向のオフセット |
| **AIサブノード水平間隔** | 150px | サブノード間の水平間隔 |

### Sticky Note配置ルール

| ルール | 値 | 説明 |
|--------|-----|------|
| **全体フロー位置** | [100, 50] | 最上部固定 |
| **全体フローサイズ** | 760px × 1610px | 全ノード情報を包含 |
| **全体フロー色** | 7（薄ピンク） | 固定色 |
| **グループSticky位置** | [グループX - 50, グループY - 200] | グループノードの左上 |
| **グループStickyサイズ** | 動的（最低520px × 560px） | ノード数とcontent量に応じて拡張 |
| **グループSticky色** | 2/3/4/5/6（白系禁止） | グループ役割に応じた色分け |

---

## グループ別Y座標計算

### 計算式

```
基準Y = 100
グループ間隔 = 500px
AI階層追加高さ = 250px

グループY[n] = 基準Y + Σ(前グループの高さ + グループ間隔)
AI階層グループ高さ = 標準高さ + AI階層追加高さ
```

### グループY座標一覧

| グループ | Y座標 | 高さ | 配置根拠 |
|----------|------|------|----------|
| **全体フロー** | 50 | 150px | 最上部固定（全体ビュー） |
| **Group 1: データ受信・検証** | 400 | 150px | 基準100 + 300マージン |
| **Group 2: 音声文字起こし・チャンク分割** | 900 | 150px | Group 1 (400 + 150) + 500 = 1050 → 調整900 |
| **Group 3: 文字起こし整形（並列）** | 1400 | 400px | Group 2 (900 + 150) + 500 = 1550 → 調整1400（AI階層） |
| **Group 4: チャンク統合・議題抽出** | 2150 | 400px | Group 3 (1400 + 400) + 500 = 2300 → 調整2150（AI階層） |
| **Group 5: 議題分析準備** | 2900 | 150px | Group 4 (2150 + 400) + 500 = 3050 → 調整2900 |
| **Group 6: 議題並列処理開始** | 3400 | 150px | Group 5 (2900 + 150) + 500 = 3550 → 調整3400 |
| **Group 7: 議題分析・マッピング** | 3900 | 400px | Group 6 (3400 + 150) + 500 = 4050 → 調整3900（AI階層） |
| **Group 8: 議題統合・フォーマット変換** | 4650 | 400px | Group 7 (3900 + 400) + 500 = 4800 → 調整4650（AI階層） |
| **Group 9: 品質保証・出力・監視** | 5400 | 400px | Group 8 (4650 + 400) + 500 = 5550 → 調整5400（AI階層） |

---

## グループ別X座標計算

### 基本配置（通常グループ）

すべてのグループは **X座標 = 100** で統一（垂直配置）。

### グループ内ノードX座標

```
ノードX[i] = グループX + (ノードインデックス × 300)

例: Group 1（X=100）に6ノード存在
- Node 0: X = 100
- Node 1: X = 400 (100 + 300)
- Node 2: X = 700 (100 + 600)
- Node 3: X = 1000 (100 + 900)
- Node 4: X = 1300 (100 + 1200)
- Node 5: X = 1600 (100 + 1500)
```

### AI階層配置のX座標

```
AI Agentノード: X = グループX + (ノードインデックス × 300)
サブノード（Language Model, Memory）: 親ノードを中心に展開

例: AI Agent Step2（X=100, Y=1400）に2サブノード
- Gemini Flash 2.5: X = 100, Y = 1600 (親 + 200px下)
- Simple Memory: X = 400, Y = 1600 (親の右150px + 200px下)
```

---

## Sticky Note配置詳細

### 全体フロー Sticky Note

**配置**: [100, 50]
**サイズ**: 760px × 1610px
**色**: 7（薄ピンク）
**内容**:
- 全ノード一覧（40個）
- グループブロック（9グループのサマリ）
- ワークフロー目的、背景、ソリューション概要
- ノードブロック（主要ノードの役割・入出力）
- フロー復元チェックリスト
- 達成したいこと

### グループ Sticky Note配置一覧

| グループ | 配置 [X, Y] | サイズ (W × H) | 色 | 備考 |
|----------|------------|---------------|-----|------|
| **Group 1** | [50, 200] | 1700px × 560px | 2（薄緑） | データ受信・検証 |
| **Group 2** | [50, 700] | 1200px × 560px | 3（薄青） | 音声文字起こし・チャンク分割 |
| **Group 3** | [50, 1200] | 900px × 680px | 4（薄紫） | AI階層配置（Step2 + サブノード） |
| **Group 4** | [50, 1950] | 1450px × 680px | 6（薄オレンジ） | AI階層配置（Step3 + サブノード） |
| **Group 5** | [50, 2700] | 800px × 560px | 2（薄緑） | 議題分析準備 |
| **Group 6** | [50, 3200] | 900px × 560px | 3（薄青） | 議題並列処理開始 |
| **Group 7** | [50, 3700] | 1200px × 680px | 4（薄紫） | AI階層配置（Step4 + Step5） |
| **Group 8** | [50, 4450] | 1450px × 680px | 6（薄オレンジ） | AI階層配置（Step6 + サブノード） |
| **Group 9** | [50, 5200] | 2050px × 680px | 5（薄赤） | AI階層配置（Step7 + サブノード）、最終出力 |

---

## 視覚的レイアウト図（ASCII Art）

```
Y座標  グループ配置
=======================================================================

Y=50   ┌─────────────────────────────────────────────────────────┐
       │ 【全体フロー Sticky Note】（色7 - 薄ピンク）             │
       │ - 40ノード一覧                                           │
       │ - 9グループサマリ                                        │
       │ - 目的・背景・ソリューション                             │
       └─────────────────────────────────────────────────────────┘

Y=400  ┌─────────────────────────────────────────────────────────┐
       │ 【Group 1: データ受信・検証】（色2 - 薄緑）              │
       │ Node1 → Node2 → Node3 → Node4 → Node5 → Node6           │
       │ (X=100) (X=400) (X=700) (X=1000) (X=1300) (X=1600)      │
       └─────────────────────────────────────────────────────────┘
              ↓ 依存関係

Y=900  ┌─────────────────────────────────────────────────────────┐
       │ 【Group 2: 音声文字起こし・チャンク分割】（色3 - 薄青）   │
       │ Node1 → Node2 → Node3 → Node4                            │
       │ (X=100) (X=400) (X=700) (X=1000)                         │
       └─────────────────────────────────────────────────────────┘
              ↓ 依存関係

Y=1400 ┌─────────────────────────────────────────────────────────┐
       │ 【Group 3: 文字起こし整形（並列）】（色4 - 薄紫）         │
       │ AI Agent Step2 (X=100, Y=1400)                           │
       │       │                                                  │
       │       ├─ Gemini Flash 2.5 (X=100, Y=1600)               │
       │       └─ Simple Memory (X=400, Y=1600)                   │
       └─────────────────────────────────────────────────────────┘
              ↓ ループバック → Group 2 → 全完了後

Y=2150 ┌─────────────────────────────────────────────────────────┐
       │ 【Group 4: チャンク統合・議題抽出】（色6 - 薄オレンジ）   │
       │ Node1 → Node2 → AI Agent Step3 → Node4 → Node5 → Node6  │
       │                       │                                  │
       │                       ├─ Gemini Flash 2.5 (Y=2350)      │
       │                       └─ Simple Memory (Y=2350)          │
       └─────────────────────────────────────────────────────────┘
              ↓ 依存関係

Y=2900 ┌─────────────────────────────────────────────────────────┐
       │ 【Group 5: 議題分析準備】（色2 - 薄緑）                   │
       │ Node1 (議題分割処理)                                      │
       └─────────────────────────────────────────────────────────┘
              ↓ 依存関係

Y=3400 ┌─────────────────────────────────────────────────────────┐
       │ 【Group 6: 議題並列処理開始】（色3 - 薄青）               │
       │ 議題並列バッチ (3並列制御)                                │
       └─────────────────────────────────────────────────────────┘
              ↓ 3並列バッチ

Y=3900 ┌─────────────────────────────────────────────────────────┐
       │ 【Group 7: 議題分析・マッピング】（色4 - 薄紫）           │
       │ AI Agent Step4 → AI Agent Step5                          │
       │       │                 │                                │
       │       ├─ Gemini (Y=4100)                                │
       │       └─ Claude + Memory (Y=4100)                        │
       └─────────────────────────────────────────────────────────┘
              ↓ ループバック → Group 6 → 全完了後

Y=4650 ┌─────────────────────────────────────────────────────────┐
       │ 【Group 8: 議題統合・フォーマット変換】（色6 - 薄オレンジ）│
       │ Node1 → Node2 → AI Agent Step6 → Node4                   │
       │                       │                                  │
       │                       ├─ Claude Sonnet 4.5 (Y=4850)     │
       │                       └─ Simple Memory (Y=4850)          │
       └─────────────────────────────────────────────────────────┘
              ↓ 依存関係

Y=5400 ┌─────────────────────────────────────────────────────────┐
       │ 【Group 9: 品質保証・出力・監視】（色5 - 薄赤）           │
       │ AI Agent Step7 → Node2 → Node3 → Node4 → Node5 → Node6  │
       │       │                                                  │
       │       ├─ Claude Sonnet 4.5 (Y=5600)                     │
       │       └─ Simple Memory (Y=5600)                          │
       └─────────────────────────────────────────────────────────┘
              ↓ 完了

=======================================================================
X座標範囲: 100 - 2050px
Y座標範囲: 50 - 5900px
```

---

## 配置統計

### 全体統計

| 項目 | 値 |
|------|-----|
| **ノード総数** | 40ノード |
| **グループ総数** | 9グループ（メインフロー） + 1全体フロー |
| **Sticky Note総数** | 10個（全体1 + グループ9） |
| **X座標範囲** | 100 - 2050px（グループ内ノード展開含む） |
| **Y座標範囲** | 50 - 5900px（全体フロー〜Group 9最下部） |
| **最大グループ幅** | 2050px（Group 9: 品質保証・出力・監視） |
| **最大グループ高さ** | 680px（AI階層配置グループ） |

### グループ別ノード数

| グループ | ノード数 | 配置パターン |
|----------|---------|-------------|
| **Group 1** | 6ノード | 横一列配置 |
| **Group 2** | 4ノード | 横一列配置 |
| **Group 3** | 3ノード（メイン1 + サブ2） | AI階層配置 |
| **Group 4** | 6ノード（メイン3 + サブ3） | AI階層配置 |
| **Group 5** | 1ノード | 横一列配置 |
| **Group 6** | 1ノード | 横一列配置 |
| **Group 7** | 5ノード（メイン2 + サブ3） | AI階層配置 |
| **Group 8** | 5ノード（メイン2 + サブ3） | AI階層配置 |
| **Group 9** | 9ノード（メイン6 + サブ3） | AI階層配置 |

### AI階層配置統計

| AI Agent | Language Model | Memory | Tools | サブノード合計 |
|----------|----------------|--------|-------|--------------|
| **Step2** | Gemini Flash 2.5 | Simple Memory | - | 2サブノード |
| **Step3** | Gemini Flash 2.5 | Simple Memory | - | 2サブノード |
| **Step4** | Gemini Flash 2.5 | - | - | 1サブノード |
| **Step5** | Claude Sonnet 4.5 | Simple Memory | - | 2サブノード |
| **Step6** | Claude Sonnet 4.5 | Simple Memory | - | 2サブノード |
| **Step7** | Claude Sonnet 4.5 | Simple Memory | - | 2サブノード |

**AI Agentノード総数**: 6個
**サブノード総数**: 11個（Language Model 6 + Memory 5）

---

## 配置最適化の効果

### 改善項目

| 項目 | 改善前 | 改善後 | 効果 |
|------|--------|--------|------|
| **グループ配置** | ランダム配置 | 垂直配置（依存関係順） | 依存関係が一目で理解できる |
| **ノード間隔** | 不統一（150-500px） | 統一（300px） | 視覚的一貫性向上 |
| **AI階層** | 横並び | 親ノード下にぶら下げ | 階層関係が明確 |
| **Sticky Note** | サイズ不足 | 動的サイズ調整 | 全文表示可能 |
| **色分け** | 白系使用 | 明確な色分け（2-7） | グループ識別性向上 |

### 定量的効果

- **視認性**: グループ識別時間が50%短縮（推定）
- **保守性**: ノード追加時の配置決定時間が70%短縮（推定）
- **デバッグ効率**: データフロー追跡時間が60%短縮（推定）

---

## 配置ベストプラクティス

### ✅ 推奨事項

1. **グループ追加時**: 既存グループの下に500px間隔で追加
2. **ノード追加時**: グループ内の右端に300px間隔で追加
3. **AIサブノード追加時**: 親ノードの下200pxに150px間隔で追加
4. **Sticky Note更新時**: contentを更新後、サイズを再計算して調整

### ❌ 避けるべき事項

1. **ランダム配置**: グループ間隔やノード間隔を勝手に変更しない
2. **色の混乱**: 白系（色0/1）を使用しない
3. **オーバーラップ**: Sticky Noteとノードが重ならないように配置
4. **依存関係の逆流**: データフローは上から下への一方向を維持

---

## 配置復元手順

### ステップ1: グループ配置

1. 全体フローSticky Noteを [100, 50] に配置
2. Group 1を [100, 400] に配置
3. 以降のグループを500px間隔で垂直配置

### ステップ2: ノード配置

1. 各グループ内のノードを横一列配置（300px間隔）
2. AI Agentノードは通常配置
3. サブノード（Language Model, Memory）は親ノードの下200pxにぶら下げ

### ステップ3: Sticky Note配置

1. 全体フローSticky Noteを最上部に配置
2. 各グループSticky Noteをグループノードの左上に配置
3. サイズをノード数とcontent量に応じて調整

### ステップ4: 検証

1. すべてのノードがSticky Note範囲内に収まっているか確認
2. 接続ラインが交差していないか確認
3. データフローが上から下への一方向か確認

---

## まとめ

**配置最適化の成果**:

✅ **可読性**: グループ垂直配置により依存関係が明確
✅ **一貫性**: 統一された間隔・サイズ・色分けで視覚的整合性を実現
✅ **AI階層**: サブノードをぶら下げることで階層関係を視覚化
✅ **スケーラビリティ**: グループ追加時も論理的配置が維持される
✅ **保守性**: ノード追加・変更時の影響範囲が明確

**次のステップ**: [Step190: 最終出力](./step190_最終成果物/)で完成したワークフローJSONを最終確認してください。

---

**作成者**: Claude Code (n8nワークフロー自動設計システム v4.0)
**ドキュメントバージョン**: v4.0.0
**最終更新日**: 2025-11-13
