# v12 ノード間隔調整 - 変更履歴

## 変更日時
2025-11-07

## 変更理由
ユーザーフィードバック: 「ノード間が離れすぎている。約半分の距離感にしてほしい」

## 変更内容

### 1. ノード間隔の調整（約半分に縮小）

#### ステップ7（メインワークフロー）

| 項目 | 変更前 | 変更後 | 削減率 |
|-----|--------|--------|--------|
| 水平間隔（最低） | 300px | **150px** | -50% |
| 水平間隔（推奨） | 400-500px | **200-250px** | -50% |
| 垂直間隔（最低） | 250px | **120px** | -52% |
| 垂直間隔（推奨） | 300-400px | **150-200px** | -50% |
| AI Agent↔サブノード | 300-500px | **150-250px** | -50% |
| 分岐後の間隔 | 300px以上 | **150px以上** | -50% |
| Sticky Note間隔 | -100px | **-80px** | -20% |

**座標例の変更**:
```
変更前:
  ノード1: [400, 500]
  ノード2: [800, 500]  // 水平400px
  ノード3: [800, 900]  // 垂直400px

変更後:
  ノード1: [300, 400]
  ノード2: [550, 400]  // 水平250px（約半分）
  ノード3: [550, 600]  // 垂直200px（約半分）
```

**推奨パターンの変更**:
```
変更前:
  Chat Trigger: [400, 600]
  次のノード: [1900, 400]  // 1500px離れる

変更後:
  Chat Trigger: [300, 450]
  次のノード: [1250, 300]  // 950px離れる（約60%削減）
```

**階層のY座標範囲の変更**:
```
変更前:
  上部層: -100〜300
  中部層: 400〜800
  下部層: 900〜1300
  最下部層: 1400〜1800

変更後:
  上部層: 50〜200      // 圧縮
  中部層: 300〜500     // 圧縮
  下部層: 650〜850     // 圧縮
  最下部層: 1000〜1200 // 圧縮
```

#### ステップ8（Error Workflow）

| 項目 | 変更前 | 変更後 | 削減率 |
|-----|--------|--------|--------|
| 水平間隔（最低） | 300px | **150px** | -50% |
| 水平間隔（推奨） | 400-500px | **200-250px** | -50% |
| 垂直間隔（最低） | 250px | **120px** | -52% |
| 垂直間隔（推奨） | 300-400px | **150-200px** | -50% |
| 分岐後の間隔 | 300px以上 | **150px以上** | -50% |
| 推奨全体幅 | 2500px以内 | **1500px以内** | -40% |
| 推奨全体高さ | 1200px以内 | **800px以内** | -33% |

**座標例の変更**:
```
変更前:
  Error Trigger: [400, 700]
  エラー情報整形: [800, 700]    // 水平400px
  重要度判定: [1200, 700]        // 水平400px
  Discord管理者通知: [1600, 400] // 上に300px

変更後:
  Error Trigger: [300, 500]
  エラー情報整形: [600, 500]    // 水平300px（約半分）
  重要度判定: [900, 500]         // 水平300px
  Discord管理者通知: [1150, 350] // 上に150px（約半分）
```

**階層のY座標範囲の変更**:
```
変更前:
  上部層: 200〜400
  中部層: 500〜700
  下部層: 800〜1000

変更後:
  上部層: 150〜250     // 圧縮
  中部層: 400〜550     // 圧縮
  下部層: 700〜800     // 圧縮
```

### 2. 評価基準の更新

**ステップ7の評価基準**:
```
変更前: ノード間の最低間隔（水平300px、垂直250px）
変更後: ノード間の最低間隔（水平150px、垂直120px）
```

**ステップ8の評価基準**:
```
変更前: 推奨サイズ（幅2500px以内、高さ1200px以内）
変更後: 推奨サイズ（幅1500px以内、高さ800px以内）
```

### 3. 制約セクションの更新

```
変更前:
- ノード間隔の最適化必須: 水平300px、垂直250px
- 視認性最優先: スクロールが必要でも構わない

変更後:
- ノード間隔の最適化必須: 水平150px、垂直120px
- バランス重視: 1-2画面スクロールで全体把握
```

### 4. 座標の重複チェック基準

```
変更前: 300px以内に他のノードが存在しないこと
変更後: 150px以内に他のノードが存在しないこと
```

## 予想される効果

### メインワークフロー（step7）

**変更前（v3の広い間隔）**:
- 幅: 約9,800px
- 高さ: 約2,100px
- スクロール: 4-5画面分

**変更後（調整後）**:
- 幅: 約5,000px（約50%削減）
- 高さ: 約1,200px（約40%削減）
- スクロール: 2-3画面分

### Error Workflow（step8）

**変更前（v3の広い間隔）**:
- 幅: 約3,000px
- 高さ: 約900px

**変更後（調整後）**:
- 幅: 約1,500px（50%削減）
- 高さ: 約800px（約10%削減）
- **1画面で全体が見渡せる可能性が高い**

## 視認性への影響

### 維持される品質
- ✅ ノードの重複防止（最低間隔150pxで十分）
- ✅ ノード名の可読性（150px間隔でも読める）
- ✅ notesフィールドの可読性（ノードをクリックして確認）
- ✅ 接続線の明確さ（120px間隔でも追える）
- ✅ 階層化（Y座標範囲は圧縮されるが、分離は維持）

### 向上する点
- ✅ コンパクトさ: スクロール量が50%削減
- ✅ 全体把握: 1-2画面で全体を見渡せる
- ✅ 操作性: ズームアウトの必要性が減る

### 注意点
- ⚠️ ノード名が長い場合、若干重なる可能性（但し、n8nは自動調整する）
- ⚠️ 複雑な分岐では接続線が若干込み入る可能性（但し、許容範囲内）

## 適用方法

### 新しいワークフローを生成する場合

**プロンプト - n8nワークフロー自動設計v12(Sticky Noteにノード名を記述).md** を使用すると、自動的に新しい間隔（200-250px水平、150-200px垂直）で生成されます。

### 既存のワークフロー（v3）を調整する場合

以下のPythonスクリプトで自動調整可能:

```python
# 座標を約半分に縮小するスクリプト
import json

with open('step7_v3.json', 'r') as f:
    data = json.load(f)

for node in data['nodes']:
    if 'position' in node:
        # X座標を約60%に縮小（0.6倍）
        node['position'][0] = int(node['position'][0] * 0.6)
        # Y座標を約60%に縮小（0.6倍）
        node['position'][1] = int(node['position'][1] * 0.6)

with open('step7_v3_compact.json', 'w') as f:
    json.dump(data, f, ensure_ascii=False, indent=2)
```

## ベストプラクティス

### 推奨する間隔

**一般的なワークフロー（10-30ノード）**:
- 水平: 200-250px
- 垂直: 150-200px
- 全体: 幅2000-3000px、高さ800-1200px

**複雑なワークフロー（30-50ノード）**:
- 水平: 200-250px（維持）
- 垂直: 150-200px（維持）
- 全体: 幅4000-6000px、高さ1200-1500px
- スクロール: 2-3画面分を許容

**シンプルなワークフロー（10ノード未満）**:
- 水平: 250-300px（やや広め）
- 垂直: 200px（やや広め）
- 全体: 幅1500px以内、高さ600px以内
- **1画面で全体を表示**

## まとめ

v12のノード間隔を約半分に調整しました:

### 変更サマリー
- ✅ 水平間隔: 400-500px → **200-250px**（約50%削減）
- ✅ 垂直間隔: 300-400px → **150-200px**（約50%削減）
- ✅ 全体サイズ: 約50%コンパクト化
- ✅ 視認性: 維持（最低間隔は十分）
- ✅ バランス: コンパクトさと見やすさの両立

### 新しい推奨サイズ
- **メインワークフロー**: 幅5,000px × 高さ1,200px（2-3画面スクロール）
- **Error Workflow**: 幅1,500px × 高さ800px（1画面で表示可能）

**今後生成されるワークフローは、この新しい間隔で生成されます。**
