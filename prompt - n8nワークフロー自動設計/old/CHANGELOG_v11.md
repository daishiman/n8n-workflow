# プロンプト - n8nワークフロー自動設計v11 変更履歴

## バージョン情報
- **ファイル名**: プロンプト - n8nワークフロー自動設計v11(Sticky Note詳細化).md
- **作成日**: 2025-11-07
- **ベースバージョン**: v10（Add sticky noteを追加）

## 主な変更内容

### 1. Sticky Note の追加（ステップ7: メインワークフロー）

#### 追加されたSticky Note（5つ）
1. **グループ1 - ユーザー対話開始** (color: 4 - 青系)
   - Chat Triggerの役割と対話開始の重要性を説明
   - 24時間365日対応できる自動応答体制の構築目的を明示

2. **グループ2 - AI推論・判断** (color: 5 - 緑系)
   - AI Agentの単一責務の原則を強調
   - Chat Model、Tools、Memoryとの連携方法を説明

3. **グループ3 - LLM推論エンジン** (color: 6 - 紫系)
   - 使用モデルとパラメータ設定の意味を解説
   - temperatureやmax_tokensが応答にどう影響するかを説明

4. **グループ4 - 会話履歴管理** (color: 3 - 黄系)
   - Memoryノードの役割と会話履歴の管理方法を説明
   - 文脈理解と一貫性のある会話の実現方法を記述

5. **グループ5 - 外部システム連携ツール** (color: 7 - 灰系)
   - Toolsの役割とAI Agentとの連携方法を説明
   - 実際のデータ取得・処理・送信の自動実行を解説

### 2. Sticky Note の追加（ステップ8: Error Workflow）

#### 追加されたSticky Note（4つ）
1. **エラーワークフロー全体説明** (color: 2 - 赤系)
   - エラーハンドリングの目的と重要性を強調
   - 5分以内の対応開始を目標とすることを明示

2. **グループ1 - エラー検知** (color: 2 - 赤系)
   - Error Triggerの役割とエラー情報の取得方法を説明
   - スタックトレースや実行コンテキストの収集を解説

3. **グループ2 - エラー情報整形** (color: 4 - 青系)
   - 技術的なエラー情報を人間が理解できる形式に変換する目的を説明
   - 迅速な対応を可能にする情報整形の重要性を強調

4. **グループ3 - エラー通知送信** (color: 5 - 緑系)
   - Discord/Slackへの即座の通知の重要性を説明
   - 1分以内の通知配信を目標とすることを明示

### 3. 処理手順の強化

#### ステップ7の処理手順9を詳細化
```
9. 各グループに Sticky Note を追加し、各ノードに詳細なコメントを追加:
   - Sticky Note: 各グループ（5つ）の目的・背景・処理の流れ・達成したいことを記述
   - _commentフィールド: 各ノードの役割と処理概要を1-2行で記述
   - notesフィールド: 処理内容、入力、出力、役割を詳細に記述（初心者が理解できるレベル）
   - 素人が見ても、このワークフローが何をするのか、なぜ必要なのか、どう動作するのかが明確に分かるようにする
```

#### ステップ8の処理手順6を詳細化
```
6. 各グループに Sticky Note を追加し、各ノードに詳細なコメントを追加:
   - Sticky Note: エラーワークフロー全体説明（1つ）+ 各グループ（3つ）の目的・背景・処理の流れ・達成したいことを記述
   - _commentフィールド: 各ノードの役割と処理概要を1-2行で記述
   - notesフィールド: 処理内容、入力、出力、役割を詳細に記述（初心者が理解できるレベル）
   - エラー発生時に何が起きるのか、どう通知されるのか、なぜ重要なのかが明確に分かるようにする
```

### 4. ガイドラインセクションの追加

#### ステップ7のJSON出力後に追加
- **Sticky Note の配置ルール**: 位置、サイズ、色分けの基準
- **Sticky Note の内容構造**: 必須要素（目的、背景、処理の流れ、達成したいこと、次のステップ）
- **ノードの_commentフィールド**: 記述形式と例
- **ノードのnotesフィールド**: 記述形式と例
- **コメント記述のポイント**: 素人目線、具体性、目的明示、例示

#### ステップ8のJSON出力後に追加
- **Error Workflow の Sticky Note とコメントのガイドライン**
- エラーワークフロー特有の配置ルールと色分け
- エラー対応者向けのコメント記述のポイント
- 緊急性、可読性、アクション指向、影響範囲の強調

### 5. 制約セクションの追加

新しい制約を3つ追加:
- **Sticky Note 必須**: ステップ7（メインワークフロー）に5つ、ステップ8（Error Workflow）に4つのSticky Noteを必ず追加
- **コメント必須**: すべてのノードに`_comment`フィールドと`notes`フィールドを追加し、素人が理解できる説明を記述
- **視覚的分かりやすさ**: Sticky Noteの色分けとグループ化により、ワークフローの構造が一目で分かるようにする

## 達成された目標

### 1. 初心者への配慮
- 技術用語を避け、誰でも理解できる説明を追加
- 各ノードの役割と処理内容を明確化
- ワークフロー全体の目的と背景を明示

### 2. 視覚的な分かりやすさ
- Sticky Noteによるグループ化で構造が一目で分かる
- 色分けにより、各グループの役割を直感的に理解できる
- 処理の流れが視覚的に追える

### 3. 実装の容易さ
- 詳細なガイドラインにより、実装者が迷わない
- notesフィールドにより、各ノードの設定意図が明確
- エラー対応時の行動が明確に示される

### 4. 保守性の向上
- コメントにより、後から見ても理解できる
- 目的と背景が明確なため、変更の影響を予測しやすい
- 素人でもワークフローの全体像を把握できる

## 検証結果

### n8n仕様準拠チェック
✅ ノードタイプ: `n8n-nodes-base.stickyNote` 正しい
✅ 必須パラメータ: height, width, color, content すべて存在
✅ パラメータ値: 適切な範囲内
✅ JSON構造: n8n仕様に完全準拠
✅ Markdown構文: 正しく使用

### ベストプラクティス適合度
**95/100点**

#### 長所:
- Markdown構文の正しい使用
- 素人にも分かりやすい説明
- 目的・背景・達成目標の明確化
- グループごとの役割分担が明確

#### 改善余地:
- テンプレート変数の実装ガイダンスをさらに詳細化
- Sticky Noteの配置座標の推奨値を具体化

## 生成されたファイル

1. **プロンプト - n8nワークフロー自動設計v11(Sticky Note詳細化).md** - メインファイル
2. **validation_report.md** - 詳細な検証レポート
3. **sticky_note_validation.json** - テスト用サンプルJSON
4. **CHANGELOG_v11.md** - このファイル

## 次のステップ

1. このテンプレートを使用して実際のワークフローを生成
2. n8nにインポートして視覚的な配置を確認
3. Sticky Noteの配置が見やすいか確認
4. 必要に応じて座標やサイズを微調整

## 注意事項

### 実装時の注意
1. UUIDは実際の値に置き換える（`crypto.randomUUID()`を使用）
2. position座標は、関連ノードの背景に適切に配置する
3. テンプレート変数 `{{GROUP*_*}}` は、具体的な業務内容に置き換える

### トラブルシューティング
- Sticky Noteが表示されない → ノードタイプとtypeVersionを確認
- contentが表示されない → Markdown構文とエスケープ文字を確認
- 色が反映されない → colorの値が1-7の範囲内か確認

