# Step1: 業務理解フェーズ - 完了

## 業務要件サマリー

### 業務名
**Google Drive M4A音声ファイルからの議事録自動生成システム**

### 目的
会議の音声記録（M4Aファイル）を自動的に文字起こしし、構造化された議事録をNotionに生成することで、議事録作成の工数を削減し、品質を標準化する。

---

## 📋 6要素の詳細

### 1. トリガー（いつ実行されるか）
- **タイプ**: Webhook（Google Drive Trigger）
- **具体的条件**:
  - Google Driveの指定フォルダにM4A形式の音声ファイルが保存（アップロード）された時
  - ファイル形式: `.m4a`
  - 監視方式: リアルタイム監視（Polling）

### 2. データソース（データの取得元）
- **プライマリソース**: Google Drive
  - M4Aファイルの取得
  - ファイルメタデータ（ファイル名、作成日時、サイズ等）
- **セカンダリソース**: 音声文字起こしAPI
  - 文字起こしサービス（例: Google Speech-to-Text、OpenAI Whisper、AssemblyAI等）
  - 音声→テキスト変換

### 3. 主要処理（データの加工内容）

#### ステップ1: 文字起こし整形（XAI Grok）
- **入力**: 生の文字起こしテキスト
- **処理**:
  - フィラー（「えー」「あー」「えっと」等）の除去
  - 1行ごとにテキストを構造化
  - JSON形式で箇条書きデータ生成
- **出力**: 整形済み箇条書きJSON配列
- **ループ処理**: 全テキストを1行ずつ処理

#### ステップ2: 議題抽出（XAI Grok）
- **入力**: 整形済み箇条書きJSON
- **処理**:
  - テキストから議題を識別・抽出
  - 議題ごとにJSONオブジェクト生成
  - 議題タイトルと関連する議論内容をマッピング
- **出力**: 議題構造化JSONオブジェクト配列

#### ステップ3: 議題分析（XAI Grok）
- **入力**: 議題構造化JSON
- **処理**:
  - 各議題から以下を抽出:
    - **決定事項**: 合意された内容
    - **宿題（タスク）**: 担当者と期限が必要な項目
    - **保留事項**: 未解決または次回持ち越しの項目
- **出力**: 分析結果を既存JSONに追記
- **ループ処理**: 議題ごとに分析

#### ステップ4: フォーマット変換（Claude Sonnet 4.5）
- **入力**: 全ステップの出力JSON
- **処理**:
  - 指定フォーマットに変換
    - タイトル生成
    - 日時設定
    - 参加者推定
    - 議題セクション構造化
  - 全ステップ情報を統合
- **出力**: 最終議事録Markdown/リッチテキスト

#### ステップ5: 品質保証（Claude Sonnet 4.5）
- **入力**: 全ステップの出力 + 最終議事録
- **処理**:
  - 全ステップの成果物を検証
  - 議事録の完全性チェック
    - 必須項目の存在確認
    - データの整合性確認
    - フォーマット準拠確認
  - 品質レポート生成
- **出力**: 検証済み議事録 + 品質レポート

### 4. 出力先（結果の送信先）
- **メイン出力**: Notion（議事録データベース）
  - 議題ごとに分割してページ作成
  - ループ処理でAPI制限を回避
- **セカンダリ出力（オプション）**:
  - Google Driveに議事録PDFをバックアップ
  - Slackに完了通知

### 5. データ規模と実行頻度
- **ファイルサイズ**:
  - M4Aファイル: 10MB〜500MB（30分〜3時間の会議を想定）
  - 文字起こしテキスト: 10,000〜50,000文字を想定
- **実行頻度**:
  - イベント駆動（ファイルアップロード時）
  - 想定: 週5〜10回（1日1〜2回）
- **処理時間想定**:
  - 文字起こし: 5〜15分（API依存）
  - AI処理: 各ステップ1〜3分
  - 合計: 15〜30分/ファイル

### 6. 制約条件

#### セキュリティ制約
- Google Drive OAuth2認証必須
- Notion API認証必須
- APIキーは環境変数で管理（ハードコード禁止）
- 音声ファイルの一時保存は暗号化

#### 性能制約
- Notion API制限: 3リクエスト/秒
  - 対策: 議題ごとにループ処理で分割送信
- 文字起こしAPI制限: プロバイダー依存
- LLM API制限: XAI/Anthropic それぞれのレート制限遵守

#### コスト制約
- 文字起こしAPIコスト: 従量課金
- LLM APIコスト: トークン従量課金
  - Grok: ステップ1,2,3で最小限のトークン使用
  - Claude: ステップ4,5で高品質処理

#### 技術制約
- M4A形式のみ対応（他形式は変換が必要）
- n8nのメモリ制限: 大きなファイルは分割処理
- タイムゾーン: Asia/Tokyo統一

---

## 🔄 処理フロー概要

```
[Google Driveトリガー]
    ↓ M4Aファイル検出
[ファイル取得]
    ↓
[音声文字起こし API]
    ↓ 生テキスト
[ステップ1: 文字起こし整形] ← XAI Grok
    ↓ 整形済みJSON（ループ処理）
[ステップ2: 議題抽出] ← XAI Grok
    ↓ 議題JSON
[ステップ3: 議題分析] ← XAI Grok
    ↓ 分析結果JSON（ループ処理）
[ステップ4: フォーマット変換] ← Claude Sonnet 4.5
    ↓ 最終議事録
[ステップ5: 品質保証] ← Claude Sonnet 4.5
    ↓ 検証済み議事録
[Notion出力] ← 議題ごとにループ処理
    ↓
[完了通知（オプション）]
```

---

## 📊 想定ノード数
- トリガー: 1ノード
- データ取得: 2〜3ノード
- AI処理（5ステップ）: 15〜25ノード
  - 各AIエージェントノード + Chat Model + Tools + Memory
- ループ処理: 3〜5ノード
- 出力: 3〜5ノード
- エラーハンドリング: 2〜3ノード

**合計想定: 26〜40ノード**（制約の10-50ノード内）

---

## ✅ ユーザー確認

この業務理解で正しいですか？修正点や追加の要件があれば教えてください。

**承認いただければ、Step2: 構造化フェーズに進みます。**
