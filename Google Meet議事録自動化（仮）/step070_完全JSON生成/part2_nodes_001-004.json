{
  "nodes": [
    {
      "parameters": {
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "mode": "id",
          "value": "1Ddh7AFQooIcogKZeLNnWPqzrq2DX97QH"
        },
        "event": "fileCreated",
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute",
              "minute": 5
            }
          ]
        },
        "options": {
          "fileType": "all"
        }
      },
      "id": "node_001_uuid",
      "name": "Google Drive Trigger",
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [300, 300],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "google_drive_oauth2_id",
          "name": "Google Drive OAuth2"
        }
      },
      "notes": "Google Driveフォルダを5分ごとに監視し、新規M4Aファイルを検知する",
      "notesInFlow": true
    },
    {
      "parameters": {
        "resource": "file",
        "operation": "get",
        "fileId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $json.id }}"
        },
        "options": {}
      },
      "id": "node_002_uuid",
      "name": "Google Drive: Get File Info",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [525, 300],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "google_drive_oauth2_id",
          "name": "Google Drive OAuth2"
        }
      },
      "notes": "トリガーされたファイルの詳細情報を取得する",
      "notesInFlow": true,
      "onError": "stopWorkflow",
      "retryOnFail": false
    },
    {
      "parameters": {
        "resource": "file",
        "operation": "download",
        "fileId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $json.id }}"
        },
        "options": {}
      },
      "id": "node_003_uuid",
      "name": "Google Drive: M4Aダウンロード",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [750, 300],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "google_drive_oauth2_id",
          "name": "Google Drive OAuth2"
        }
      },
      "notes": "M4A音声ファイルをバイナリデータとしてダウンロードする",
      "notesInFlow": true,
      "onError": "continueErrorOutput",
      "retryOnFail": true,
      "maxTries": 3,
      "waitBetweenTries": 2000
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "filter_cond_001",
              "operator": {
                "type": "string",
                "operation": "contains"
              },
              "leftValue": "={{ $('Google Drive: Get File Info').first().json.mimeType }}",
              "rightValue": "audio"
            },
            {
              "id": "filter_cond_002",
              "operator": {
                "type": "string",
                "operation": "endsWith"
              },
              "leftValue": "={{ $('Google Drive: Get File Info').first().json.name }}",
              "rightValue": ".m4a"
            }
          ]
        }
      },
      "id": "node_004_uuid",
      "name": "Filter: M4A検証",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [975, 300],
      "notes": "ファイル形式がM4Aであることを検証する。非M4Aファイルは処理しない。",
      "notesInFlow": true
    }
  ]
}
