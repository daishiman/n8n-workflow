{
  "nodes": [
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "or",
          "conditions": [
            {
              "id": "if_cond_001",
              "operator": {
                "type": "string",
                "operation": "equals"
              },
              "leftValue": "={{ $json.status }}",
              "rightValue": "ok"
            },
            {
              "id": "if_cond_002",
              "operator": {
                "type": "string",
                "operation": "equals"
              },
              "leftValue": "={{ $json.status }}",
              "rightValue": "補完実施"
            }
          ]
        }
      },
      "id": "node_018_uuid",
      "name": "IF: 品質保証ステータス判定",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [3225, 100],
      "notes": "品質保証のステータスがokまたは補完実施の場合のみ保存する",
      "notesInFlow": true,
      "_comment": "True Path (Output 0) → 議事録保存、False Path (Output 1) → Error Workflow"
    },
    {
      "parameters": {
        "resource": "file",
        "operation": "upload",
        "name": "=minutes - {{ $now.format('YYYY-MM-DD') }} - {{ $('AI Agent: Step2 議題抽出').first().json.meeting_name }}.md",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "mode": "id",
          "value": "議事録_出力フォルダID"
        },
        "options": {
          "mimeType": "text/markdown"
        },
        "binaryData": false,
        "fileContent": "={{ $json.markdown }}"
      },
      "id": "node_019_uuid",
      "name": "Google Drive: 議事録保存",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [3450, 100],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "google_drive_oauth2_id",
          "name": "Google Drive OAuth2"
        }
      },
      "notes": "最終議事録をGoogle Driveの指定フォルダに保存",
      "notesInFlow": true,
      "onError": "continueErrorOutput",
      "retryOnFail": true,
      "maxTries": 3,
      "waitBetweenTries": 2000
    },
    {
      "parameters": {
        "resource": "file",
        "operation": "move",
        "fileId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $('Google Drive Trigger').first().json.id }}"
        },
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "mode": "id",
          "value": "processedフォルダID"
        }
      },
      "id": "node_020_uuid",
      "name": "Google Drive: M4Aファイル移動",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [3675, 100],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "google_drive_oauth2_id",
          "name": "Google Drive OAuth2"
        }
      },
      "notes": "処理済みM4Aファイルをprocessed/フォルダに移動",
      "notesInFlow": true,
      "onError": "continueRegularOutput",
      "retryOnFail": false
    },
    {
      "parameters": {
        "url": "={{ $env.DISCORD_WEBHOOK_URL }}",
        "method": "POST",
        "sendBody": true,
        "contentType": "json",
        "jsonBody": "={\"content\": \"✅ 議事録生成完了\", \"embeds\": [{\"title\": \"{{ $('AI Agent: Step2 議題抽出').first().json.meeting_name }}\", \"fields\": [{\"name\": \"議事録\", \"value\": \"{{ $('Google Drive: 議事録保存').first().json.webViewLink }}\"}, {\"name\": \"処理時間\", \"value\": \"{{ $workflow.duration }}秒\"}], \"color\": 5814783}]}",
        "options": {}
      },
      "id": "node_021_uuid",
      "name": "HTTP Request: Discord Webhook",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [3900, 100],
      "notes": "処理完了をDiscordに通知（オプション）",
      "notesInFlow": true,
      "onError": "continueRegularOutput",
      "retryOnFail": false
    }
  ]
}
