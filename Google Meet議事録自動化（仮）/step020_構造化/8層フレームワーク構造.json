{
  "workflow_name": "Google Meet議事録自動化",
  "creation_date": "2025-01-09",
  "last_updated": "2025-01-09 (Gemini直接文字起こしに変更)",
  "framework_version": "8層フレームワーク v1.1",
  "template_reference": {
    "template_id": 3076,
    "template_name": "Use OpenAI to Transcribe Audio + Summarize with AI + Save to Google Drive",
    "author": "Joseph LePage",
    "url": "https://n8n.io/workflows/3076",
    "nodes_count": 33,
    "views": 18348,
    "major_changes": [
      {
        "layer": "Fetch Layer",
        "change": "Google Drive Download追加（M4Aバイナリ取得）"
      },
      {
        "layer": "Transform Layer",
        "change": "Deepgram API削除、Gemini直接文字起こしに変更"
      },
      {
        "layer": "Transform Layer",
        "change": "並列チャンク処理とオーバーラップ方式を追加"
      },
      {
        "layer": "Action Layer",
        "change": "AI Agent Nodeを5つ（Step0-5）使用、Geminiで文字起こし+整形"
      }
    ],
    "improvements": [
      "処理時間50%短縮（5分 → 2.5-3.5分）",
      "コスト70-85%削減（Deepgram削除）",
      "認証情報簡素化（3個 → 2個）"
    ]
  },
  "layered_structure": {
    "layer_1_trigger": {
      "description": "ワークフロー起動のトリガー設定",
      "tasks": [
        {
          "task_id": "T1-01",
          "task_name": "Google Drive新規ファイル検知",
          "type": "Google Drive Trigger",
          "trigger_type": "polling",
          "polling_interval": "5分ごと",
          "target_folder_id": "1Ddh7AFQooIcogKZeLNnWPqzrq2DX97QH",
          "filter_conditions": [
            "拡張子が .m4a のファイル",
            "前回チェック以降に追加されたファイル",
            "ファイル名に [処理済] や processed が含まれない"
          ],
          "template_node": "On File Created Trigger (Google Drive Trigger)",
          "output": "新規M4Aファイルのメタデータ"
        }
      ]
    },
    "layer_2_fetch": {
      "description": "データソースからのデータ取得",
      "parallel_execution_possible": false,
      "tasks": [
        {
          "task_id": "T2-01",
          "task_name": "M4Aファイル情報取得",
          "type": "Google Drive: Get File Info",
          "source": "Google Drive",
          "data_to_fetch": [
            "fileId",
            "fileName",
            "mimeType",
            "createdTime",
            "size"
          ],
          "template_node": "Get file info from Google Drive",
          "output": "ファイルメタデータ"
        },
        {
          "task_id": "T2-02",
          "task_name": "M4A音声ファイルダウンロード",
          "type": "Google Drive: Download File",
          "source": "Google Drive",
          "dependency": "T2-01",
          "template_node": "Download audio file",
          "output": "M4Aバイナリデータ",
          "note": "Gemini文字起こしに渡すためのバイナリデータ取得"
        }
      ]
    },
    "layer_3_validate": {
      "description": "取得データの妥当性検証",
      "tasks": [
        {
          "task_id": "T3-01",
          "task_name": "ファイル形式検証",
          "type": "Filter Node",
          "validation_rules": [
            "mimeType === 'audio/m4a' または 'audio/mp4'",
            "fileSize > 0",
            "fileName が null でない"
          ],
          "error_handling": "エラーフローへルーティング",
          "template_node": "Filter by .m4a extension",
          "output": "検証済みファイル情報"
        }
      ]
    },
    "layer_4_transform": {
      "description": "データ変換・加工処理",
      "parallel_execution_possible": true,
      "tasks": [
        {
          "task_id": "T4-01",
          "task_name": "Gemini音声文字起こし",
          "type": "Google Gemini: Transcribe Audio",
          "node_type": "@n8n/n8n-nodes-langchain.googleGemini",
          "resource": "audio",
          "operation": "transcribe",
          "model": "models/gemini-2.0-flash-exp",
          "features": [
            "Native M4A Support（ネイティブM4A対応）",
            "Speaker Diarization（プロンプトベース話者分離）",
            "Punctuation（句読点自動挿入）",
            "Timestamps（audioTimestamp=true で有効化）",
            "Max Duration: 8.4 hours (1 million tokens)"
          ],
          "authentication": "GOOGLE_API_KEY",
          "input": "M4Aバイナリデータ",
          "template_node": "新規追加（Gemini直接文字起こし）",
          "output": "JSON配列（話者分離、タイムスタンプ付き文字起こし）",
          "estimated_duration": "30-60秒（Deepgramより50%短縮）",
          "advantages": [
            "Deepgram不要で外部API削減",
            "コスト70-85%削減",
            "処理時間50%短縮",
            "認証情報1つ削減"
          ]
        },
        {
          "task_id": "T4-02",
          "task_name": "文字起こしテキストのチャンク分割",
          "type": "Code Node",
          "logic": "20-30行ごとに分割 + 前後6行のオーバーラップ追加",
          "chunk_size": "25行（20-30の中央値）",
          "overlap_size": "6行（前後3チャンク）",
          "dependency": "T4-01",
          "template_node": "新規追加（テンプレートにはない）",
          "output": "チャンク配列 [{chunk_id, main_text, overlap_before, overlap_after, line_range}, ...]",
          "note": "Gemini出力のJSON配列を入力として使用"
        },
        {
          "task_id": "T4-03",
          "task_name": "チャンク並列処理開始",
          "type": "Split in Batches",
          "batch_size": 5,
          "parallel_execution": true,
          "dependency": "T4-02",
          "template_node": "新規追加（テンプレートにはない）",
          "output": "バッチ化されたチャンク"
        },
        {
          "task_id": "T4-04",
          "task_name": "Step1: 文字起こし整形（並列AI処理）",
          "type": "AI Agent Node",
          "chat_model": "Google Gemini Flash 2.0",
          "memory": "なし（並列処理のため）",
          "temperature": 0.4,
          "max_tokens": 4000,
          "processing_unit": "1チャンク",
          "ai_task": "フィラー除去 + 箇条書き化",
          "dependency": "T4-03",
          "parallel_execution": true,
          "template_node": "新規追加（AI Agent使用）",
          "output": "整形済みJSON配列（チャンク単位）"
        },
        {
          "task_id": "T4-05",
          "task_name": "チャンク統合と重複除去",
          "type": "Merge Node + Code Node",
          "logic": "各チャンクのmain_textのみを抽出、line_rangeで統合、重複削除",
          "dependency": "T4-04",
          "template_node": "Merge All Paths（応用）",
          "output": "統合JSON配列（全行の整形済みデータ）"
        },
        {
          "task_id": "T4-06",
          "task_name": "Step2: 議題抽出（AI処理）",
          "type": "AI Agent Node",
          "chat_model": "Google Gemini Flash 2.0",
          "memory": "あり（Simple Memory、session_key: step2_memory）",
          "temperature": 0.4,
          "max_tokens": 4000,
          "ai_task": "統合JSONから議題を自動抽出、line_idsを記録",
          "dependency": "T4-05",
          "template_node": "Summarize to JSON（AI Agent化）",
          "output": "議題JSON [{agenda_id, title, line_ids}, ...]"
        },
        {
          "task_id": "T4-07",
          "task_name": "議題ごとのデータ再構成",
          "type": "Code Node",
          "logic": "各議題のline_idsに対応する文字起こしを統合JSONから抽出",
          "dependency": "T4-06",
          "template_node": "新規追加（テンプレートにはない）",
          "output": "議題別JSON [{agenda_id, title, lines: [...], context: {...}}, ...]"
        },
        {
          "task_id": "T4-08",
          "task_name": "議題並列処理開始",
          "type": "Split in Batches",
          "batch_size": 3,
          "parallel_execution": true,
          "dependency": "T4-07",
          "template_node": "新規追加（テンプレートにはない）",
          "output": "バッチ化された議題"
        },
        {
          "task_id": "T4-09",
          "task_name": "Step3: 議題分析（並列AI処理）",
          "type": "AI Agent Node",
          "chat_model": "Google Gemini Flash 2.0",
          "memory": "なし（並列処理のため）",
          "temperature": 0.4,
          "max_tokens": 4000,
          "processing_unit": "1議題 + 該当する全文字起こし",
          "ai_task": "決定事項、宿題、保留事項の抽出",
          "dependency": "T4-08",
          "parallel_execution": true,
          "template_node": "新規追加（AI Agent使用）",
          "output": "分析JSON（議題単位）"
        },
        {
          "task_id": "T4-10",
          "task_name": "議題統合",
          "type": "Merge Node",
          "logic": "全議題の分析結果を統合",
          "dependency": "T4-09",
          "template_node": "Merge All Paths（応用）",
          "output": "全議題の分析結果JSON"
        },
        {
          "task_id": "T4-11",
          "task_name": "Step4: フォーマット変換（AI処理）",
          "type": "AI Agent Node",
          "chat_model": "Claude Sonnet 4.5",
          "memory": "あり（Simple Memory、session_key: step4_memory）",
          "temperature": 0.7,
          "max_tokens": 8000,
          "ai_task": "全データを統合し、指定フォーマットのMarkdown議事録を生成",
          "dependency": "T4-10",
          "template_node": "Convert JSON to Markdown（AI Agent化）",
          "output": "Markdown議事録"
        },
        {
          "task_id": "T4-12",
          "task_name": "Step5: 品質保証（AI処理）",
          "type": "AI Agent Node",
          "chat_model": "Claude Sonnet 4.5",
          "memory": "あり（Simple Memory、session_key: step5_memory）",
          "temperature": 0.7,
          "max_tokens": 8000,
          "ai_task": "議事録の完全性検証、不足項目の補完",
          "dependency": "T4-11",
          "template_node": "新規追加（テンプレートにはない）",
          "output": "最終Markdown（検証済み）+ 警告メッセージ"
        }
      ]
    },
    "layer_5_decision": {
      "description": "条件分岐による処理フローの制御",
      "tasks": [
        {
          "task_id": "T5-01",
          "task_name": "品質保証ステータス判定",
          "type": "IF Node",
          "condition": "step5Output.status === 'ok' OR 'completed'",
          "true_path": "議事録保存フローへ",
          "false_path": "エラー通知フローへ",
          "dependency": "T4-12",
          "template_node": "新規追加（エラーハンドリング用）",
          "output": "分岐判定結果"
        }
      ]
    },
    "layer_6_action": {
      "description": "データ処理後の実行アクション",
      "parallel_execution_possible": false,
      "tasks": [
        {
          "task_id": "T6-01",
          "task_name": "議事録Markdownファイル保存",
          "type": "Google Drive: Upload File",
          "action": "Google Driveに議事録を保存",
          "target_folder": "議事録_出力/",
          "file_name_format": "minutes - {YYYY-MM-DD} - {会議名}.md",
          "mime_type": "text/markdown",
          "encoding": "UTF-8",
          "dependency": "T5-01 (true_path)",
          "template_node": "Save Markdown file to Google Drive",
          "output": "保存されたファイルのメタデータ"
        },
        {
          "task_id": "T6-02",
          "task_name": "元のM4Aファイルを移動",
          "type": "Google Drive: Move File",
          "action": "処理済みM4Aファイルをprocessed/フォルダに移動",
          "source": "トリガーで検知したファイル",
          "target_folder": "processed/",
          "dependency": "T6-01",
          "template_node": "新規追加（ファイル整理用）",
          "output": "移動後のファイル情報"
        }
      ]
    },
    "layer_7_merge": {
      "description": "複数データソースの統合",
      "tasks": [
        {
          "task_id": "T7-01",
          "task_name": "チャンク統合（Step1後）",
          "type": "Merge Node",
          "strategy": "全チャンクの整形結果を統合、重複除去",
          "merge_method": "配列結合 + line_idソート",
          "dependency": "T4-04",
          "template_node": "Merge All Paths（応用）",
          "output": "統合JSON配列（全文字起こし）"
        },
        {
          "task_id": "T7-02",
          "task_name": "議題統合（Step3後）",
          "type": "Merge Node",
          "strategy": "全議題の分析結果を統合",
          "merge_method": "配列結合 + agenda_idソート",
          "dependency": "T4-09",
          "template_node": "Merge All Paths（応用）",
          "output": "全議題の分析結果JSON"
        }
      ]
    },
    "layer_8_output": {
      "description": "処理結果の出力・記録",
      "tasks": [
        {
          "task_id": "T8-01",
          "task_name": "完了通知（Discord、オプション）",
          "type": "Discord Webhook",
          "destination": "Discord管理者チャンネル",
          "notification_content": [
            "処理完了ファイル名",
            "議事録保存先URL",
            "合計処理時間",
            "AI処理ステップの成功/失敗状況"
          ],
          "dependency": "T6-02",
          "template_node": "Send Telegram Message（Discordに変更）",
          "output": "通知送信結果"
        }
      ]
    }
  },
  "parallel_processing_map": {
    "chunk_processing": {
      "location": "T4-04（Step1: 文字起こし整形）",
      "description": "20-30行ごとのチャンクを5並列で処理",
      "batch_size": 5,
      "estimated_speedup": "5倍（5チャンク同時処理）",
      "constraint": "APIレート制限を考慮"
    },
    "agenda_processing": {
      "location": "T4-09（Step3: 議題分析）",
      "description": "議題ごとに独立して分析を3並列で処理",
      "batch_size": 3,
      "estimated_speedup": "3倍（3議題同時処理）",
      "constraint": "APIレート制限を考慮"
    }
  },
  "dependency_graph": {
    "critical_path": [
      "T1-01 → T2-01 → T2-02 → T3-01 → T4-01 → T4-02 → T4-03 → T4-04 → T4-05 → T4-06 → T4-07 → T4-08 → T4-09 → T4-10 → T4-11 → T4-12 → T5-01 → T6-01 → T6-02 → T8-01"
    ],
    "parallel_sections": [
      {
        "section": "チャンク並列処理",
        "tasks": ["T4-04（5並列）"]
      },
      {
        "section": "議題並列処理",
        "tasks": ["T4-09（3並列）"]
      }
    ]
  },
  "ai_agent_mapping": {
    "total_ai_agents": 5,
    "agents": [
      {
        "agent_id": "AI-01",
        "task_id": "T4-04",
        "name": "文字起こし整形エージェント",
        "responsibility": "フィラー除去と箇条書き化",
        "chat_model": "Google Gemini Flash 2.0",
        "memory": "なし",
        "parallel": true
      },
      {
        "agent_id": "AI-02",
        "task_id": "T4-06",
        "name": "議題抽出エージェント",
        "responsibility": "会話から議題を自動抽出",
        "chat_model": "Google Gemini Flash 2.0",
        "memory": "あり（step2_memory）",
        "parallel": false
      },
      {
        "agent_id": "AI-03",
        "task_id": "T4-09",
        "name": "議題分析エージェント",
        "responsibility": "決定事項、宿題、保留事項の抽出",
        "chat_model": "Google Gemini Flash 2.0",
        "memory": "なし",
        "parallel": true
      },
      {
        "agent_id": "AI-04",
        "task_id": "T4-11",
        "name": "フォーマット変換エージェント",
        "responsibility": "Markdown議事録生成",
        "chat_model": "Claude Sonnet 4.5",
        "memory": "あり（step4_memory）",
        "parallel": false
      },
      {
        "agent_id": "AI-05",
        "task_id": "T4-12",
        "name": "品質保証エージェント",
        "responsibility": "議事録の完全性検証と補完",
        "chat_model": "Claude Sonnet 4.5",
        "memory": "あり（step5_memory）",
        "parallel": false
      }
    ],
    "single_responsibility_check": {
      "AI-01": "✅ フィラー除去と箇条書き化のみ",
      "AI-02": "✅ 議題抽出のみ",
      "AI-03": "✅ 議題分析のみ",
      "AI-04": "✅ フォーマット変換のみ",
      "AI-05": "✅ 品質保証のみ"
    }
  },
  "data_flow_summary": {
    "stage_1": "トリガー → ファイル取得 → 検証",
    "stage_2": "文字起こし → チャンク分割 → 並列整形（5並列）→ 統合",
    "stage_3": "議題抽出 → データ再構成 → 並列分析（3並列）→ 統合",
    "stage_4": "フォーマット変換 → 品質保証",
    "stage_5": "保存 → ファイル移動 → 通知"
  },
  "performance_estimation": {
    "target": "1時間会議を5分以内に処理",
    "breakdown": {
      "trigger_and_fetch": "15秒（Download追加）",
      "transcription": "30-60秒（Gemini直接、50%短縮）",
      "chunk_processing": "30-60秒（並列化により短縮）",
      "agenda_extraction": "20-30秒",
      "agenda_analysis": "30-60秒（並列化により短縮）",
      "format_conversion": "30-45秒",
      "quality_assurance": "20-30秒",
      "save_and_move": "10-15秒",
      "total": "150-320秒（2.5-5.3分）"
    },
    "improvements": {
      "deepgram_removal": "Deepgram 60-120秒削除 → Gemini 30-60秒に変更（60秒短縮）",
      "chunk_processing": "逐次処理なら150-300秒 → 並列化で30-60秒（5倍高速化）",
      "agenda_processing": "逐次処理なら90-180秒 → 並列化で30-60秒（3倍高速化）"
    }
  },
  "node_count_estimation": {
    "trigger_layer": 1,
    "fetch_layer": 2,
    "validate_layer": 1,
    "transform_layer": 12,
    "decision_layer": 1,
    "action_layer": 2,
    "merge_layer": 2,
    "output_layer": 1,
    "error_handling": 5,
    "total_nodes": 27,
    "ai_agent_nodes": 5,
    "sub_nodes": 10,
    "constraint_check": "✅ 10-50ノード制約を満たす（27ノード）"
  },
  "error_handling_design": {
    "error_workflow_required": true,
    "error_cases": [
      {
        "error_type": "Gemini文字起こし失敗",
        "trigger": "T4-01のエラー出力",
        "action": "M4Aファイルを /エラー/ フォルダに移動、Discord通知"
      },
      {
        "error_type": "AI処理失敗",
        "trigger": "T4-04, T4-06, T4-09, T4-11, T4-12のエラー出力",
        "action": "部分生成された議事録を [ERROR]minutes - ... として保存、Discord通知"
      },
      {
        "error_type": "Google Drive保存失敗",
        "trigger": "T6-01のエラー出力",
        "action": "n8n内部ストレージに一時保存、リトライ（最大3回）、Discord通知"
      }
    ]
  },
  "next_step": {
    "step_number": "030",
    "step_name": "タスク分解フェーズ",
    "description": "8層構造をn8nノード単位に分解し、ノード設定の詳細を定義"
  }
}
