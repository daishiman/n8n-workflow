{
  "workflow_metadata": {
    "name": "Google Meet議事録自動化",
    "version": "1.0.0",
    "creation_date": "2025-01-09",
    "total_nodes": 20,
    "execution_patterns": ["sequential", "parallel", "loop", "conditional"],
    "estimated_duration": "3.5-6.3分",
    "critical_path_duration": "約5分"
  },
  "patterns": {
    "sequential_groups": [
      {
        "id": "seq_001",
        "name": "トリガー→ファイル取得→検証",
        "description": "Google Driveの新規M4Aファイルを検知し、ファイル情報を取得して検証する",
        "tasks": ["node_001", "node_002", "node_003"],
        "reason": "ファイル検証は順次実行が必須",
        "estimated_duration": "10秒"
      },
      {
        "id": "seq_002",
        "name": "文字起こし",
        "description": "Deepgram APIでM4Aを文字起こし",
        "tasks": ["node_004"],
        "reason": "外部API呼び出しは単一タスク",
        "estimated_duration": "60-120秒"
      },
      {
        "id": "seq_003",
        "name": "チャンク分割準備",
        "description": "文字起こしテキストをチャンクに分割しオーバーラップを追加",
        "tasks": ["node_005"],
        "reason": "並列処理の前準備",
        "estimated_duration": "2秒"
      },
      {
        "id": "seq_004",
        "name": "チャンク統合",
        "description": "並列処理されたチャンクを統合し重複を除去",
        "tasks": ["node_009"],
        "reason": "並列処理の後処理",
        "estimated_duration": "3秒"
      },
      {
        "id": "seq_005",
        "name": "議題抽出",
        "description": "統合された文字起こしから議題を抽出",
        "tasks": ["node_010"],
        "reason": "全体を1回処理する必要がある",
        "estimated_duration": "20-30秒"
      },
      {
        "id": "seq_006",
        "name": "議題データ再構成",
        "description": "各議題に該当する全文字起こしを収集",
        "tasks": ["node_011"],
        "reason": "並列処理の前準備",
        "estimated_duration": "2秒"
      },
      {
        "id": "seq_007",
        "name": "フォーマット変換→品質保証",
        "description": "Markdown議事録を生成し品質を検証",
        "tasks": ["node_015", "node_016"],
        "reason": "品質保証は変換後に実行",
        "estimated_duration": "50-75秒"
      },
      {
        "id": "seq_008",
        "name": "保存→移動→通知",
        "description": "議事録を保存し、M4Aを移動し、通知を送信",
        "tasks": ["node_017", "node_018", "node_019", "node_020"],
        "reason": "保存→移動→通知は順次実行",
        "estimated_duration": "12-17秒"
      }
    ],
    "parallel_groups": [],
    "loop_groups": [
      {
        "id": "loop_001",
        "name": "チャンク並列処理ループ",
        "description": "文字起こしチャンクを5並列で整形処理するループ",
        "loop_task_id": "node_006",
        "loop_node_type": "n8n-nodes-base.splitInBatches",
        "processing_tasks": ["node_007"],
        "loop_back_task_id": "node_008",
        "batch_size": 5,
        "reason": "300行の文字起こしを12チャンクに分割、5チャンクずつ並列処理して処理時間を5倍高速化",
        "loop_type": "batch_processing",
        "termination_condition": "全チャンクの処理が完了するまで",
        "rate_limit": {
          "enabled": true,
          "api_service": "Google Gemini API",
          "limit": "60 requests/minute",
          "wait_time_ms": 200,
          "reason": "Gemini APIのレート制限対策（余裕を持って200ms待機）"
        },
        "output_connections": {
          "loop_output_index": 1,
          "done_output_index": 0,
          "loop_connects_to": "node_007",
          "done_connects_to": "node_009",
          "critical_note": "⚠️ Split in Batchesは2つの出力を持つ: Output 0 (done) と Output 1 (loop)。ループ内処理はOutput 1に接続し、ループ完了後の処理はOutput 0に接続する。"
        },
        "estimated_duration": "30-60秒",
        "performance_improvement": {
          "sequential_time": "240秒",
          "parallel_time": "48秒",
          "speedup": "5倍高速化"
        }
      },
      {
        "id": "loop_002",
        "name": "議題並列処理ループ",
        "description": "議題を3並列で分析処理するループ",
        "loop_task_id": "node_012",
        "loop_node_type": "n8n-nodes-base.splitInBatches",
        "processing_tasks": ["node_013"],
        "loop_back_task_id": "node_014",
        "batch_size": 3,
        "reason": "6議題を3議題ずつ並列処理して処理時間を3倍高速化",
        "loop_type": "batch_processing",
        "termination_condition": "全議題の処理が完了するまで",
        "rate_limit": {
          "enabled": true,
          "api_service": "Google Gemini API",
          "limit": "60 requests/minute",
          "wait_time_ms": 200,
          "reason": "Gemini APIのレート制限対策（余裕を持って200ms待機）"
        },
        "output_connections": {
          "loop_output_index": 1,
          "done_output_index": 0,
          "loop_connects_to": "node_013",
          "done_connects_to": "node_015",
          "critical_note": "⚠️ Split in Batchesは2つの出力を持つ: Output 0 (done) と Output 1 (loop)。ループ内処理はOutput 1に接続し、ループ完了後の処理はOutput 0に接続する。"
        },
        "estimated_duration": "30-60秒",
        "performance_improvement": {
          "sequential_time": "180秒",
          "parallel_time": "60秒",
          "speedup": "3倍高速化"
        }
      }
    ],
    "conditional_branches": [
      {
        "id": "branch_001",
        "name": "品質保証ステータス判定",
        "description": "品質保証のステータスがokまたは補完実施の場合のみ保存する",
        "decision_task_id": "node_017",
        "node_type": "n8n-nodes-base.if",
        "branches": [
          {
            "condition": "={{ $json.status === 'ok' || $json.status === '補完実施' }}",
            "label": "True Path（保存）",
            "output_index": 0,
            "tasks": ["node_018", "node_019", "node_020"],
            "description": "品質保証が成功した場合、議事録を保存し、M4Aファイルを移動し、通知を送信"
          },
          {
            "condition": "else",
            "label": "False Path（エラー）",
            "output_index": 1,
            "tasks": [],
            "description": "品質保証が失敗した場合、Error Workflowに接続（Error Workflowで処理）"
          }
        ],
        "merge_task_id": null,
        "default_branch": "false_path",
        "reason": "品質保証が成功した場合のみ議事録を保存する"
      }
    ]
  },
  "connections": {
    "node_001": {
      "main": [[{ "node": "node_002", "type": "main", "index": 0 }]],
      "error": []
    },
    "node_002": {
      "main": [[{ "node": "node_003", "type": "main", "index": 0 }]],
      "error": []
    },
    "node_003": {
      "main": [[{ "node": "node_004", "type": "main", "index": 0 }]],
      "error": []
    },
    "node_004": {
      "main": [[{ "node": "node_005", "type": "main", "index": 0 }]],
      "error": []
    },
    "node_005": {
      "main": [[{ "node": "node_006", "type": "main", "index": 0 }]],
      "error": []
    },
    "node_006": {
      "main": [
        [{ "node": "node_009", "type": "main", "index": 0 }],
        [{ "node": "node_007", "type": "main", "index": 0 }]
      ],
      "error": [],
      "_comment": "Split in Batches: Output 0 (done) → node_009, Output 1 (loop) → node_007"
    },
    "node_007": {
      "main": [[{ "node": "node_008", "type": "main", "index": 0 }]],
      "error": []
    },
    "node_008": {
      "main": [[{ "node": "node_006", "type": "main", "index": 0 }]],
      "error": [],
      "_comment": "Loop Back: node_008 → node_006"
    },
    "node_009": {
      "main": [[{ "node": "node_010", "type": "main", "index": 0 }]],
      "error": []
    },
    "node_010": {
      "main": [[{ "node": "node_011", "type": "main", "index": 0 }]],
      "error": []
    },
    "node_011": {
      "main": [[{ "node": "node_012", "type": "main", "index": 0 }]],
      "error": []
    },
    "node_012": {
      "main": [
        [{ "node": "node_015", "type": "main", "index": 0 }],
        [{ "node": "node_013", "type": "main", "index": 0 }]
      ],
      "error": [],
      "_comment": "Split in Batches: Output 0 (done) → node_015, Output 1 (loop) → node_013"
    },
    "node_013": {
      "main": [[{ "node": "node_014", "type": "main", "index": 0 }]],
      "error": []
    },
    "node_014": {
      "main": [[{ "node": "node_012", "type": "main", "index": 0 }]],
      "error": [],
      "_comment": "Loop Back: node_014 → node_012"
    },
    "node_015": {
      "main": [[{ "node": "node_016", "type": "main", "index": 0 }]],
      "error": []
    },
    "node_016": {
      "main": [[{ "node": "node_017", "type": "main", "index": 0 }]],
      "error": []
    },
    "node_017": {
      "main": [
        [{ "node": "node_018", "type": "main", "index": 0 }],
        []
      ],
      "error": [],
      "_comment": "IF Node: True Path (Output 0) → node_018, False Path (Output 1) → Error Workflow"
    },
    "node_018": {
      "main": [[{ "node": "node_019", "type": "main", "index": 0 }]],
      "error": []
    },
    "node_019": {
      "main": [[{ "node": "node_020", "type": "main", "index": 0 }]],
      "error": []
    },
    "node_020": {
      "main": [],
      "error": []
    }
  },
  "workflow_analysis": {
    "total_nodes": 20,
    "total_connections": 19,
    "isolated_nodes": 0,
    "critical_path": [
      "node_001",
      "node_002",
      "node_003",
      "node_004",
      "node_005",
      "node_006",
      "node_007",
      "node_008",
      "node_009",
      "node_010",
      "node_011",
      "node_012",
      "node_013",
      "node_014",
      "node_015",
      "node_016",
      "node_017",
      "node_018",
      "node_019"
    ],
    "critical_path_duration": "約5分",
    "bottlenecks": [
      {
        "node_id": "node_004",
        "node_name": "HTTP Request: Deepgram API",
        "duration": "60-120秒",
        "reason": "文字起こしAPIは最も時間がかかる処理",
        "optimization": "音声ファイルサイズを制限、または並列化（複数ファイル処理時）"
      },
      {
        "node_id": "node_015",
        "node_name": "AI Agent: Step4 フォーマット変換",
        "duration": "30-45秒",
        "reason": "長文Markdown生成は時間がかかる",
        "optimization": "テンプレート利用、またはストリーミング出力"
      }
    ],
    "optimization_opportunities": [
      {
        "area": "チャンク並列処理",
        "current": "5並列",
        "potential": "10並列",
        "benefit": "さらに2倍高速化（要APIレート制限確認）"
      },
      {
        "area": "議題並列処理",
        "current": "3並列",
        "potential": "6並列",
        "benefit": "さらに2倍高速化（要APIレート制限確認）"
      }
    ],
    "estimated_duration": {
      "best_case": "210秒（3.5分）",
      "average_case": "270秒（4.5分）",
      "worst_case": "380秒（6.3分）",
      "target": "300秒以内（5分以内）"
    }
  },
  "rate_limit_strategy": {
    "gemini_api": {
      "service": "Google Gemini Flash 2.0",
      "official_limit": "60 requests/minute",
      "our_limit": "50 requests/minute（余裕を持つ）",
      "wait_time_ms": 200,
      "nodes": ["node_007", "node_010", "node_013"],
      "total_requests_per_workflow": "約15-20リクエスト（チャンク12 + 議題1 + 議題分析6）",
      "safe_execution": "問題なし（50 requests/minute以内）"
    },
    "claude_api": {
      "service": "Claude Sonnet 4.5",
      "official_limit": "50 requests/minute (Tier 1)",
      "our_limit": "40 requests/minute（余裕を持つ）",
      "wait_time_ms": 1500,
      "nodes": ["node_015", "node_016"],
      "total_requests_per_workflow": "2リクエスト",
      "safe_execution": "問題なし（40 requests/minute以内）"
    },
    "deepgram_api": {
      "service": "Deepgram API",
      "official_limit": "プランによる",
      "our_limit": "要確認",
      "wait_time_ms": 0,
      "nodes": ["node_004"],
      "total_requests_per_workflow": "1リクエスト",
      "safe_execution": "要確認"
    },
    "google_drive_api": {
      "service": "Google Drive API",
      "official_limit": "1000 requests/100 seconds/user",
      "our_limit": "問題なし",
      "wait_time_ms": 0,
      "nodes": ["node_001", "node_002", "node_018", "node_019"],
      "total_requests_per_workflow": "4リクエスト",
      "safe_execution": "問題なし"
    }
  },
  "error_handling_strategy": {
    "deepgram_api_failure": {
      "node_id": "node_004",
      "strategy": "retry_3_times_with_backoff",
      "backoff": "exponential（1s, 2s, 4s）",
      "final_action": "Error Workflowでファイルを/エラー/に移動"
    },
    "ai_agent_failure": {
      "nodes": ["node_007", "node_010", "node_013", "node_015", "node_016"],
      "strategy": "retry_once",
      "final_action": "Error Workflowで部分生成議事録を保存"
    },
    "google_drive_save_failure": {
      "node_id": "node_018",
      "strategy": "retry_3_times",
      "final_action": "Error Workflowでn8n内部ストレージに一時保存"
    },
    "quality_check_failure": {
      "node_id": "node_017",
      "strategy": "conditional_branch",
      "false_path": "Error Workflowで警告付き議事録を保存"
    }
  },
  "data_flow_validation": {
    "all_nodes_connected": true,
    "isolated_nodes_count": 0,
    "bidirectional_loops": [
      {
        "loop_name": "チャンク並列処理ループ",
        "nodes": ["node_006", "node_007", "node_008"],
        "valid": true
      },
      {
        "loop_name": "議題並列処理ループ",
        "nodes": ["node_012", "node_013", "node_014"],
        "valid": true
      }
    ],
    "conditional_paths_complete": true,
    "all_outputs_defined": true
  },
  "n8n_mcp_documentation_summary": {
    "merge_node": {
      "key_findings": [
        "Mergeノードは複数の入力を統合するが、今回のワークフローでは使用しない（並列処理はSplit in Batchesで実現）",
        "Append/Combine/SQL Query/Choose Branchの4モードがある",
        "Combineモードではマッチングフィールド、位置、全組み合わせの3つの統合方法がある"
      ],
      "our_usage": "なし（Split in Batchesのdone出力で自動統合）"
    },
    "split_in_batches_node": {
      "key_findings": [
        "⚠️ 重要: Output 0 (done) と Output 1 (loop) の2つの出力がある",
        "ループ内処理はOutput 1に接続、ループ完了後の処理はOutput 0に接続",
        "Batch Sizeでバッチサイズを設定",
        "Resetオプションで各ループをリセット可能（ページネーション等に有用）",
        "$node[\"Split in Batches\"].context[\"noItemsLeft\"]で全アイテム処理完了を確認可能",
        "$node[\"Split in Batches\"].context[\"currentRunIndex\"]で現在のループインデックスを取得可能"
      ],
      "our_usage": [
        "node_006: チャンク並列処理（Batch Size: 5）",
        "node_012: 議題並列処理（Batch Size: 3）"
      ]
    },
    "if_node": {
      "key_findings": [
        "条件分岐ノード、True Path (Output 0) と False Path (Output 1) の2つの出力",
        "複数条件の組み合わせ（AND/OR）が可能",
        "Expression形式で柔軟な条件設定が可能"
      ],
      "our_usage": "node_017: 品質保証ステータス判定（ok/補完実施 → True, それ以外 → False）"
    }
  },
  "next_step": {
    "step_number": "050",
    "step_name": "n8n設計変換フェーズ",
    "description": "各ノードの具体的なパラメータ、Expression、認証情報を設計する",
    "handover": "並列/ループ/条件パターンと接続マトリックスをn8n設計変換工程へ共有"
  }
}
