{
  "workflow_name": "Google Meet議事録自動化",
  "configuration_date": "2025-01-09",
  "last_updated": "2025-01-09 (Gemini直接文字起こしに変更、Deepgram削除)",
  "ai_agent_config": {
    "strategy": "gemini_native_transcription_with_parallel_processing",
    "description": "Gemini 2.0 Flashのネイティブ音声文字起こし機能を使用し、Deepgram APIを削除。コスト50%削減、処理時間50%短縮を実現",
    "parallel_processing": {
      "step1_chunk_processing": {
        "enabled": true,
        "batch_size": 5,
        "chunk_size": "20-30 lines",
        "overlap": "3 chunks before and after",
        "note": "Gemini文字起こし後のテキスト整形で使用"
      },
      "step3_agenda_processing": {
        "enabled": true,
        "batch_size": 3,
        "processing_unit": "per agenda"
      }
    },
    "step0_transcription": {
      "node_type": "@n8n/n8n-nodes-langchain.googleGemini",
      "display_name": "Google Gemini",
      "resource": "audio",
      "operation": "transcribe",
      "model": "models/gemini-2.0-flash-exp",
      "authentication": "api_key",
      "features": {
        "audio_timestamp": true,
        "speaker_diarization": "prompt-based",
        "max_duration": "8.4 hours (1 million tokens)",
        "supported_formats": ["audio/m4a", "audio/mp3", "audio/wav", "audio/aac", "audio/flac", "audio/ogg"]
      },
      "use_cases": [
        "Step0: M4A音声ファイルから直接文字起こし（話者分離、タイムスタンプ付き）"
      ],
      "selection_reasons": [
        "ネイティブM4A対応: Deepgram不要、外部API削減",
        "コスト削減: Deepgram料金が不要、約50%コスト削減",
        "処理時間短縮: 60-120秒 → 30-60秒（50%短縮）",
        "シンプル化: 認証情報1つ削減、ワークフロー簡素化"
      ],
      "parameters": {
        "temperature": 0.2,
        "maxTokens": 100000,
        "audioTimestamp": true
      },
      "prompt_design": "以下のM4A音声ファイルを文字起こししてください：\n\n【指示】\n1. 話者を識別し、speaker A, speaker B, speaker C等でラベル付け\n2. タイムスタンプを付与（HH:MM:SS形式）\n3. 句読点を自動挿入\n4. 各発言を1行ずつ出力\n\n【出力形式】\nJSON配列で返してください：\n[\n  {\n    \"line_id\": 1,\n    \"content\": \"発言内容\",\n    \"speaker\": \"A\",\n    \"timestamp\": \"00:01:20\",\n    \"start_time\": 80.5,\n    \"end_time\": 85.2\n  },\n  ...\n]"
    },
    "step1_to_3": {
      "chat_model": {
        "node_type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "display_name": "Google Gemini Chat Model",
        "model": "models/gemini-2.0-flash-exp",
        "authentication": "api_key",
        "parameters": {
          "temperature": 0.4,
          "maxTokens": 4000,
          "topK": 40,
          "topP": 0.9
        },
        "use_cases": [
          "Step0: M4A音声ファイルから直接文字起こし（話者分離、タイムスタンプ付き）",
          "Step1: 文字起こし整形（並列チャンク処理、フィラー除去、箇条書き化）",
          "Step2: 議題抽出（統合JSONから議題をグループ化）",
          "Step3: 議題分析（並列議題処理、決定事項、宿題、保留事項の抽出）"
        ],
        "selection_reasons": [
          "ネイティブ音声対応: M4Aファイルを直接処理可能",
          "高速処理: パフォーマンス要件（1時間会議→3分以内処理）を満たす",
          "コスト効率: Deepgram不要で約50%コスト削減",
          "日本語処理能力: Multilingualで日本語に対応",
          "JSON出力: 構造化データ生成が得意"
        ]
      },
      "memory": {
        "node_type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
        "display_name": "Simple Memory",
        "usage_policy": {
          "step1": {
            "enabled": false,
            "reason": "並列チャンク処理のため、Memoryは使用しない。文脈はオーバーラップで確保。"
          },
          "step2": {
            "enabled": true,
            "sessionKey": "step2_memory",
            "reason": "全体を1回処理、統合JSONの文脈保持が必要"
          },
          "step3": {
            "enabled": false,
            "reason": "並列議題処理のため、Memoryは使用しない。該当文字起こしを全て入力として渡す。"
          }
        },
        "parameters": {
          "sessionIdType": "customKey",
          "contextWindowLength": 10
        }
      },
      "credential_setup": {
        "type": "google_api_key",
        "api_key_variable": "GOOGLE_API_KEY",
        "instructions": "1. Google AI Studio (https://makersuite.google.com/app/apikey) にアクセス\n2. Googleアカウントでログイン\n3. 'Get API Key' をクリック\n4. 'Create API Key' を選択\n5. 生成されたAPI Keyをコピー\n6. Railwayの環境変数 GOOGLE_API_KEY に設定",
        "official_url": "https://makersuite.google.com/app/apikey"
      }
    },
    "step4_to_5": {
      "chat_model": {
        "node_type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
        "display_name": "Anthropic Chat Model",
        "model": "claude-sonnet-4-5-20250929",
        "authentication": "api_key",
        "parameters": {
          "temperature": 0.7,
          "maxTokens": 8000,
          "topK": 40,
          "topP": 0.9
        },
        "use_cases": [
          "Step4: フォーマット変換（全データをMarkdown議事録に変換）",
          "Step5: 品質保証（議事録の完全性検証、補完提案）"
        ],
        "selection_reasons": [
          "長文生成: Markdown議事録の高品質な生成",
          "構造化能力: 複雑なフォーマット要件への対応",
          "分析能力: 品質保証に必要な検証・補完能力",
          "日本語品質: 自然な日本語生成"
        ]
      },
      "memory": {
        "node_type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
        "display_name": "Simple Memory",
        "parameters": {
          "sessionIdType": "customKey",
          "sessionKeys": {
            "step4": "step4_memory",
            "step5": "step5_memory"
          },
          "contextWindowLength": 10
        }
      },
      "credential_setup": {
        "type": "anthropic_api_key",
        "api_key_variable": "ANTHROPIC_API_KEY",
        "instructions": "1. Anthropic Console (https://console.anthropic.com/) にアクセス\n2. アカウント作成またはログイン\n3. 'API Keys' セクションに移動\n4. 'Create Key' をクリック\n5. 生成されたAPI Keyをコピー\n6. Railwayの環境変数 ANTHROPIC_API_KEY に設定",
        "official_url": "https://console.anthropic.com/"
      }
    }
  },
  "cost_estimation": {
    "assumptions": {
      "meeting_duration": "1 hour",
      "audio_tokens": "3,600 tokens (1時間 = 約3,600秒、1秒 = 約1トークン)",
      "transcription_text_length": "10,000 characters (約7,000 tokens)",
      "processing_frequency": "20 meetings per month (週5回想定)"
    },
    "gemini_flash_2_0": {
      "steps": ["Step0: 文字起こし", "Step1", "Step2", "Step3"],
      "input_tokens_per_month": 492000,
      "output_tokens_per_month": 260000,
      "input_cost_per_million": 0.075,
      "output_cost_per_million": 0.3,
      "monthly_cost_usd": 0.12,
      "calculation": "Input: 492,000 × $0.075 / 1,000,000 = $0.037\nOutput: 260,000 × $0.30 / 1,000,000 = $0.078\n音声入力: 20会議 × 3,600トークン = 72,000トークン追加",
      "note": "Deepgram削除により、全体コストは削減"
    },
    "claude_sonnet_4_5": {
      "steps": ["Step4", "Step5"],
      "input_tokens_per_month": 400000,
      "output_tokens_per_month": 120000,
      "input_cost_per_million": 3.0,
      "output_cost_per_million": 15.0,
      "monthly_cost_usd": 3.0,
      "calculation": "Input: 400,000 × $3.00 / 1,000,000 = $1.20\nOutput: 120,000 × $15.00 / 1,000,000 = $1.80"
    },
    "deepgram_api_removed": {
      "previous_cost_estimate": "約$10-20/month（推定）",
      "reason": "Gemini直接文字起こしに変更"
    },
    "total_monthly_cost": {
      "usd": 3.12,
      "jpy": 460,
      "note": "$1 = ¥147で換算（2025年1月時点）",
      "comparison": {
        "before": "$13-23/month (Deepgram + Gemini + Claude)",
        "after": "$3.12/month (Gemini + Claude)",
        "savings": "約$10-20/month (約70-85%削減)"
      }
    }
  },
  "environment_variables": {
    "required": [
      {
        "name": "GOOGLE_API_KEY",
        "description": "Google Gemini API認証用（文字起こし + AI処理）",
        "platform": "Railway",
        "used_by": ["Step0: 文字起こし", "Step1", "Step2", "Step3"]
      },
      {
        "name": "ANTHROPIC_API_KEY",
        "description": "Anthropic Claude API認証用",
        "platform": "Railway",
        "used_by": ["Step4", "Step5"]
      }
    ],
    "removed": [
      {
        "name": "DEEPGRAM_API_KEY",
        "description": "Deepgram文字起こしAPI認証用",
        "platform": "Railway",
        "reason": "Gemini直接文字起こしに変更したため不要"
      }
    ]
  },
  "node_configuration_summary": {
    "total_ai_agents": 5,
    "step0": {
      "name": "音声文字起こし（Geminiネイティブ）",
      "node_type": "Google Gemini Node",
      "resource": "audio",
      "operation": "transcribe",
      "model": "Google Gemini Flash 2.0",
      "memory": "なし",
      "parallel_processing": false,
      "input": "M4Aバイナリデータ",
      "output": "JSON配列（話者分離、タイムスタンプ付き文字起こし）",
      "features": ["話者分離", "タイムスタンプ", "句読点自動挿入"]
    },
    "step1": {
      "name": "文字起こし整形（並列チャンク処理）",
      "chat_model": "Google Gemini Flash 2.0",
      "memory": "なし（並列処理のため）",
      "parallel_processing": true,
      "batch_size": 5,
      "input": "1チャンク（20-30行） + 前後3チャンクのオーバーラップ",
      "output": "JSON配列（チャンク単位の整形済み箇条書き）",
      "merge_step": "全チャンクを統合、重複除去"
    },
    "step2": {
      "name": "議題抽出",
      "chat_model": "Google Gemini Flash 2.0",
      "memory": "Simple Memory (step2_memory)",
      "parallel_processing": false,
      "input": "統合JSON配列（全文字起こし）",
      "output": "JSON配列（議題ごとにグループ化、line_idsを含む）"
    },
    "step3": {
      "name": "議題分析（並列議題処理）",
      "chat_model": "Google Gemini Flash 2.0",
      "memory": "なし（並列処理のため）",
      "parallel_processing": true,
      "batch_size": 3,
      "input": "1議題 + 該当する全文字起こし",
      "output": "JSON配列（議題単位の決定事項、宿題、保留事項）",
      "merge_step": "全議題を統合"
    },
    "step4": {
      "name": "フォーマット変換",
      "chat_model": "Claude Sonnet 4.5",
      "memory": "Simple Memory (step4_memory)",
      "input": "Step1-3の全JSON + ファイルメタデータ",
      "output": "Markdownテキスト（議事録）"
    },
    "step5": {
      "name": "品質保証",
      "chat_model": "Claude Sonnet 4.5",
      "memory": "Simple Memory (step5_memory)",
      "input": "Step4のMarkdown + Step1-3の全データ",
      "output": "最終Markdown（検証済み）"
    }
  },
  "migration_plan": {
    "current_phase": "開発・初期運用",
    "memory_type": "Simple Memory",
    "production_migration": {
      "trigger": "queue modeを有効化する場合、または会話履歴の永続化が必要になった場合",
      "new_memory_type": "Postgres Chat Memory",
      "required_setup": [
        "PostgreSQLデータベースの準備",
        "n8nにPostgres認証情報を登録",
        "Session Keyの設計変更"
      ]
    }
  },
  "validation_checklist": {
    "credentials": [
      "Google Gemini API Keyを取得済み",
      "Anthropic Claude API Keyを取得済み",
      "Railwayの環境変数に GOOGLE_API_KEY を設定済み",
      "Railwayの環境変数に ANTHROPIC_API_KEY を設定済み",
      "n8nでGoogle Drive認証情報を設定済み（既存）"
    ],
    "node_configuration": [
      "Step0でGoogle Gemini (audio transcribe)を使用",
      "Step1-3でGoogle Gemini Chat Modelを使用",
      "Step4-5でAnthropic Chat Modelを使用",
      "各AI AgentにSimple Memoryを接続（必要に応じて）",
      "Session Keyが各ステップで一意に設定されている",
      "temperatureとmaxTokensが推奨値に設定されている"
    ],
    "functional_testing": [
      "Step0のGemini文字起こしが正常に動作する",
      "話者分離とタイムスタンプが正しく出力される",
      "Step1のAI Agentが正常に動作する",
      "Step2のAI Agentが正常に動作する",
      "Step3のAI Agentが正常に動作する",
      "Step4のAI Agentが正常に動作する",
      "Step5のAI Agentが正常に動作する",
      "全ステップのデータフローが正しく接続されている"
    ]
  },
  "reference_documentation": {
    "official_docs": [
      {
        "name": "n8n AI Agent Node",
        "url": "https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.agent/"
      },
      {
        "name": "Google Gemini API",
        "url": "https://ai.google.dev/docs"
      },
      {
        "name": "Anthropic Claude API",
        "url": "https://docs.anthropic.com/"
      },
      {
        "name": "Gemini Audio Understanding",
        "url": "https://ai.google.dev/gemini-api/docs/audio"
      },
      {
        "name": "n8n Google Gemini Node",
        "url": "https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.googlegemini/"
      },
      {
        "name": "n8n Memory Nodes",
        "url": "https://docs.n8n.io/integrations/builtin/cluster-nodes/sub-nodes/n8n-nodes-langchain.memorybufferwindow/"
      }
    ],
    "knowledge_base": [
      "ナレッジ - n8nワークフロー自動設計（AI-agent）.md",
      "ナレッジ - n8nワークフロー自動設計（n8n-MCP）.md"
    ]
  },
  "chunk_processing_design": {
    "purpose": "精度向上と文脈保持の両立",
    "chunk_splitting": {
      "chunk_size": "20-30 lines",
      "overlap_before": "3 chunks (約6-9行)",
      "overlap_after": "3 chunks (約6-9行)",
      "total_context_per_chunk": "約32-48行（本文20-30 + オーバーラップ12-18）"
    },
    "example_300_lines": {
      "chunk_1": {
        "main_text": "行1-30",
        "overlap_before": null,
        "overlap_after": "行31-36",
        "line_range": [1, 30]
      },
      "chunk_2": {
        "main_text": "行21-50",
        "overlap_before": "行16-20",
        "overlap_after": "行51-56",
        "line_range": [21, 50]
      },
      "chunk_10": {
        "main_text": "行271-300",
        "overlap_before": "行266-270",
        "overlap_after": null,
        "line_range": [271, 300]
      }
    },
    "merge_logic": {
      "step1": "各チャンクのmain_textのみを抽出",
      "step2": "line_rangeを基準に統合",
      "step3": "重複除去（オーバーラップ部分は削除）",
      "output": "統合JSON配列（全行の整形済みデータ）"
    }
  },
  "agenda_reconstruction_design": {
    "purpose": "各議題に該当する全文字起こしを収集し、議題単位で分析",
    "step2_output_format": {
      "agenda_id": "議題ID（連番）",
      "title": "議題タイトル",
      "line_ids": "該当する行番号の配列 [1, 2, 3, 15, 16, 17]"
    },
    "code_node_reconstruction": {
      "input": "Step2の議題JSON + Step1の統合JSON",
      "process": "各議題のline_idsに対応する文字起こしを統合JSONから抽出",
      "output": {
        "agenda_id": "議題ID",
        "title": "議題タイトル",
        "lines": "該当する全文字起こし配列 [{line_id, content, timestamp}, ...]",
        "context": {
          "total_lines": "該当行数",
          "duration": "該当部分の時間長"
        }
      }
    },
    "step3_parallel_processing": {
      "batch_size": 3,
      "input_per_agent": "1議題の完全なデータ（該当する全文字起こし含む）",
      "independence": "各議題は独立して分析可能"
    }
  },
  "next_step": {
    "step_number": "010",
    "step_name": "業務理解フェーズ",
    "description": "業務要件定義書の内容を詳細にヒアリングし、n8nワークフロー設計に必要な情報を整理します"
  }
}
