{
  "workflow_metadata": {
    "name": "Google Meet議事録自動化",
    "version": "1.1.0",
    "last_updated": "2025-01-09 (Gemini直接文字起こしに変更)",
    "total_nodes": 23,
    "total_main_nodes": 20,
    "total_subnodes": 10,
    "total_groups": 12,
    "gemini_transcribe_node": 1,
    "ai_agent_nodes": 5,
    "chat_model": "Google Gemini Flash 2.0 (Step0-3) / Claude Sonnet 4.5 (Step4-5)",
    "estimated_time": "2.5-5.3分",
    "complexity": "medium",
    "data_volume": "1時間会議 = 約300行の文字起こし",
    "improvements": {
      "processing_time": "40-50%短縮（5-6分 → 2.5-3.5分）",
      "cost": "70-85%削減（Deepgram $10-20/month削除）",
      "external_apis": "2個（Deepgram + Gemini） → 1個（Geminiのみ）",
      "credentials": "3個 → 2個（DEEPGRAM_API_KEY削除）",
      "node_count": "22ノード → 20メインノード（Deepgram削除、Gemini追加）"
    }
  },
  "groups": [
    {
      "group_id": "group_01",
      "group_name": "トリガー&ファイル取得&ダウンロード",
      "group_purpose": "Google Driveの新規M4Aファイルを検知し、ファイル情報を取得し、バイナリデータをダウンロードする",
      "group_description": "5分ごとにGoogle Driveをポーリングし、新規M4Aファイルが追加されたら、ファイルメタデータを取得し、M4Aバイナリをダウンロード",
      "sticky_note_color": 7,
      "estimated_duration": "15秒",
      "execution_pattern": "sequential",
      "tasks": [
        {
          "id": "node_001",
          "name": "Google Drive Trigger",
          "description": "Google Driveフォルダを5分ごとに監視し、新規M4Aファイルを検知する",
          "layer": "Trigger",
          "node_type": "n8n-nodes-base.googleDriveTrigger",
          "execution_mode": "polling",
          "dependencies": [],
          "ai_required": false,
          "estimated_duration": "5秒",
          "data_transformation": "ファイルメタデータを出力",
          "error_handling": {
            "strategy": "continue_on_error",
            "fallback": "Error Workflowでログ記録"
          },
          "parameters": {
            "triggerOn": "specificFolder",
            "folderToWatch": {
              "__rl": true,
              "mode": "id",
              "value": "1Ddh7AFQooIcogKZeLNnWPqzrq2DX97QH"
            },
            "event": "fileCreated",
            "pollTimes": {
              "item": [{"mode": "everyMinute", "minute": 5}]
            },
            "options": {"fileType": "all"}
          }
        },
        {
          "id": "node_002",
          "name": "Google Drive: Get File Info",
          "description": "トリガーされたファイルの詳細情報を取得する",
          "layer": "Fetch",
          "node_type": "n8n-nodes-base.googleDrive",
          "execution_mode": "sequential",
          "dependencies": ["node_001"],
          "ai_required": false,
          "estimated_duration": "3秒",
          "data_transformation": "ファイルメタデータ取得",
          "error_handling": {
            "strategy": "stop_on_error",
            "fallback": "Error Workflowでファイルを/エラー/に移動"
          },
          "parameters": {
            "resource": "file",
            "operation": "get",
            "fileId": {"__rl": true, "mode": "id", "value": "={{ $json.id }}"},
            "options": {}
          }
        },
        {
          "id": "node_003",
          "name": "Google Drive: M4Aダウンロード",
          "description": "M4A音声ファイルをバイナリデータとしてダウンロードする",
          "layer": "Fetch",
          "node_type": "n8n-nodes-base.googleDrive",
          "execution_mode": "sequential",
          "dependencies": ["node_002"],
          "ai_required": false,
          "estimated_duration": "5秒",
          "data_transformation": "ファイルメタデータ→M4Aバイナリ",
          "error_handling": {
            "strategy": "retry_3_times",
            "fallback": "Error Workflowでエラーログ"
          },
          "parameters": {
            "resource": "file",
            "operation": "download",
            "fileId": {"__rl": true, "mode": "id", "value": "={{ $json.id }}"},
            "options": {}
          }
        },
        {
          "id": "node_004",
          "name": "Filter: M4A検証",
          "description": "ファイル形式がM4Aであることを検証する",
          "layer": "Validate",
          "node_type": "n8n-nodes-base.filter",
          "execution_mode": "sequential",
          "dependencies": ["node_003"],
          "ai_required": false,
          "estimated_duration": "1秒",
          "data_transformation": "M4Aファイルのみ通過させる",
          "error_handling": {
            "strategy": "filter_out",
            "fallback": "非M4Aファイルは処理しない"
          },
          "parameters": {
            "conditions": {
              "combinator": "and",
              "conditions": [
                {
                  "leftValue": "={{ $('Google Drive: Get File Info').first().json.mimeType }}",
                  "operator": {"type": "string", "operation": "contains"},
                  "rightValue": "audio"
                },
                {
                  "leftValue": "={{ $('Google Drive: Get File Info').first().json.name }}",
                  "operator": {"type": "string", "operation": "endsWith"},
                  "rightValue": ".m4a"
                }
              ]
            }
          }
        }
      ]
    },
    {
      "group_id": "group_02",
      "group_name": "音声文字起こし（Geminiネイティブ）",
      "group_purpose": "M4A音声ファイルをGemini 2.0 Flashで直接文字起こしする",
      "group_description": "Geminiのネイティブ音声処理機能を使用して、話者分離・タイムスタンプ付きで文字起こしを実行。Deepgram不要で処理時間50%短縮、コスト70-85%削減",
      "sticky_note_color": 6,
      "estimated_duration": "30-60秒",
      "execution_pattern": "sequential",
      "tasks": [
        {
          "id": "node_005",
          "name": "Google Gemini: Transcribe Audio",
          "description": "Gemini 2.0 FlashでM4Aファイルを文字起こしする（ネイティブ音声処理）",
          "layer": "Transform",
          "node_type": "@n8n/n8n-nodes-langchain.googleGemini",
          "execution_mode": "sequential",
          "dependencies": ["node_004"],
          "ai_required": true,
          "ai_responsibility": "音声からテキストへの変換、話者分離、タイムスタンプ付与",
          "estimated_duration": "30-60秒",
          "data_transformation": "M4A音声→JSON配列（話者分離、タイムスタンプ付き）",
          "error_handling": {
            "strategy": "retry_3_times_with_backoff",
            "backoff": "exponential (2s, 4s, 8s)",
            "fallback": "Error Workflowでファイルを/エラー/に移動"
          },
          "parameters": {
            "resource": "audio",
            "operation": "transcribe",
            "modelId": {
              "__rl": true,
              "mode": "list",
              "value": "models/gemini-2.0-flash-exp"
            },
            "inputBinary": "data",
            "text": "以下のM4A音声ファイルを文字起こししてください：\n\n【指示】\n1. 話者を識別し、speaker A, speaker B, speaker C等でラベル付け\n2. タイムスタンプを付与（HH:MM:SS形式）\n3. 句読点を自動挿入\n4. 各発言を1行ずつ区切って出力\n5. 発言の開始時刻と終了時刻を秒単位で記録\n\n【出力形式】\nJSON配列で返してください：\n[\n  {\n    \"line_id\": 1,\n    \"content\": \"発言内容\",\n    \"speaker\": \"A\",\n    \"timestamp\": \"00:01:20\",\n    \"start_time\": 80.5,\n    \"end_time\": 85.2\n  },\n  ...\n]",
            "options": {
              "temperature": 0.2,
              "maxTokens": 100000,
              "audioTimestamp": true
            }
          },
          "advantages": [
            "✅ Deepgram不要で外部API削減",
            "✅ 処理時間50%短縮（60-120秒 → 30-60秒）",
            "✅ コスト70-85%削減（Deepgram料金 $10-20/month不要）",
            "✅ 認証情報1つ削減（DEEPGRAM_API_KEY不要）",
            "✅ ネイティブM4A対応（変換不要）",
            "✅ 1つのAPIで完結（Gemini統合）"
          ],
          "n8n_mcp_validation": {
            "nodeType": "@n8n/n8n-nodes-langchain.googleGemini",
            "resource": "audio",
            "operation": "transcribe",
            "valid": true,
            "supported_formats": ["audio/m4a", "audio/mp3", "audio/wav", "audio/aac", "audio/flac", "audio/ogg"],
            "max_duration": "8.4 hours",
            "features": ["speaker diarization (prompt-based)", "timestamps (audioTimestamp=true)", "punctuation"]
          }
        }
      ]
    },
    {
      "group_id": "group_03",
      "group_name": "チャンク分割準備",
      "group_purpose": "文字起こしテキストを20-30行ごとに分割し、オーバーラップを追加する",
      "group_description": "Gemini出力のJSON配列を約12チャンクに分割、前後3チャンク（約6行）のオーバーラップを追加して文脈を確保",
      "sticky_note_color": 5,
      "estimated_duration": "2秒",
      "execution_pattern": "sequential",
      "tasks": [
        {
          "id": "node_006",
          "name": "Code: チャンク分割+オーバーラップ",
          "description": "Gemini文字起こし結果をチャンクに分割し、前後6行のオーバーラップを追加する",
          "layer": "Transform",
          "node_type": "n8n-nodes-base.code",
          "execution_mode": "sequential",
          "dependencies": ["node_005"],
          "ai_required": false,
          "estimated_duration": "2秒",
          "data_transformation": "JSON配列→チャンク配列",
          "error_handling": {
            "strategy": "stop_on_error",
            "fallback": "Error Workflowでエラーログ"
          },
          "parameters": {
            "mode": "runOnceForAllItems",
            "language": "javaScript",
            "jsCode": "// Gemini文字起こし結果から行配列を取得（すでにJSON配列形式）\nconst geminiOutput = $input.first().json;\nconst lines = Array.isArray(geminiOutput) ? geminiOutput : (geminiOutput.lines || []);\n\n// Gemini出力はすでにline_id, content, speaker, timestamp等を含む\n// チャンク分割設定\nconst chunkSize = 25;  // 20-30行の中央値\nconst overlapSize = 6;  // 前後3チャンク分（約6行）\n\nconst chunks = [];\nfor (let i = 0; i < lines.length; i += chunkSize) {\n  const mainLines = lines.slice(i, i + chunkSize);\n  const overlapBefore = i > 0 ? lines.slice(Math.max(0, i - overlapSize), i) : null;\n  const overlapAfter = i + chunkSize < lines.length ? lines.slice(i + chunkSize, Math.min(lines.length, i + chunkSize + overlapSize)) : null;\n  \n  chunks.push({\n    chunk_id: Math.floor(i / chunkSize) + 1,\n    main_text: mainLines,\n    overlap_before: overlapBefore,\n    overlap_after: overlapAfter,\n    line_range: [mainLines[0].line_id, mainLines[mainLines.length - 1].line_id],\n    total_lines: mainLines.length\n  });\n}\n\nreturn chunks.map(chunk => ({ json: chunk }));"
          }
        }
      ]
    },
    {
      "group_id": "group_04",
      "group_name": "Step1: 文字起こし整形（並列5チャンク）",
      "group_purpose": "各チャンクのフィラー除去と箇条書き化を並列処理する",
      "group_description": "5チャンク並列で文字起こしを整形し、処理時間を5倍高速化する",
      "sticky_note_color": 4,
      "estimated_duration": "30-60秒",
      "execution_pattern": "parallel",
      "tasks": [
        {
          "id": "node_007",
          "name": "Split in Batches: チャンク並列処理",
          "description": "チャンクを5個ずつのバッチに分割して並列処理を可能にする",
          "layer": "Transform",
          "node_type": "n8n-nodes-base.splitInBatches",
          "execution_mode": "sequential",
          "dependencies": ["node_006"],
          "ai_required": false,
          "estimated_duration": "0秒",
          "data_transformation": "チャンク配列→バッチ",
          "error_handling": {
            "strategy": "continue_on_error",
            "fallback": "エラーチャンクはスキップ"
          },
          "parameters": {
            "batchSize": 5,
            "options": {"reset": false}
          }
        },
        {
          "id": "node_008",
          "name": "AI Agent: Step1 文字起こし整形",
          "description": "フィラー語を除去し、意味のある文章単位で箇条書き化する（並列実行）",
          "layer": "Transform",
          "node_type": "@n8n/n8n-nodes-langchain.agent",
          "execution_mode": "parallel",
          "dependencies": ["node_007"],
          "ai_required": true,
          "ai_responsibility": "フィラー除去と箇条書き化",
          "estimated_duration": "10-20秒/チャンク",
          "data_transformation": "生テキスト→整形済みJSON",
          "error_handling": {
            "strategy": "retry_once",
            "fallback": "Error Workflowで部分生成議事録を保存"
          },
          "subnodes": [
            {
              "subnode_id": "subnode_008_01",
              "subnode_name": "Google Gemini Chat Model",
              "subnode_type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
              "connection_type": "ai_languageModel",
              "parameters": {
                "modelName": "models/gemini-2.0-flash-exp",
                "options": {"temperature": 0.4, "maxTokens": 4000, "topK": 40, "topP": 0.9}
              }
            }
          ],
          "parameters": {
            "promptType": "define",
            "text": "以下の文字起こしテキストを整形してください：\n\n【メインテキスト】\n{{ $json.main_text }}\n\n【前後の文脈（参考用）】\n前: {{ $json.overlap_before }}\n後: {{ $json.overlap_after }}\n\n【指示】\n1. フィラー語を除去\n2. 意味のある文章単位で箇条書き化\n3. 話者情報とタイムスタンプを保持\n4. メインテキストのみ整形して返す\n\n【出力形式】\nJSON配列：[{\"line_id\": 1, \"content\": \"整形後の文章\", \"speaker\": \"A\", \"timestamp\": \"00:01:20\"}, ...]",
            "options": {"systemMessage": "あなたは日本語の文字起こしテキストを整形する専門家です。"},
            "hasOutputParser": true
          }
        },
        {
          "id": "node_009",
          "name": "Loop Back: バッチ処理継続",
          "description": "全バッチ処理が完了するまでループバックする",
          "layer": "Transform",
          "node_type": "n8n-nodes-base.splitInBatches",
          "execution_mode": "sequential",
          "dependencies": ["node_008"],
          "ai_required": false,
          "estimated_duration": "0秒",
          "data_transformation": "バッチループ制御",
          "error_handling": {
            "strategy": "continue",
            "fallback": "次のバッチへ"
          },
          "parameters": {"mode": "loop"}
        }
      ]
    },
    {
      "group_id": "group_05",
      "group_name": "チャンク統合と重複除去",
      "group_purpose": "全チャンクの整形結果を統合し、重複行を除去する",
      "group_description": "各チャンクのmain_textのみを抽出し、line_idでソートして重複除去",
      "sticky_note_color": 3,
      "estimated_duration": "3秒",
      "execution_pattern": "sequential",
      "tasks": [
        {
          "id": "node_010",
          "name": "Code: チャンク統合+重複除去",
          "description": "全チャンクの整形結果を統合し、オーバーラップ部分の重複を除去する",
          "layer": "Merge",
          "node_type": "n8n-nodes-base.code",
          "execution_mode": "sequential",
          "dependencies": ["node_009"],
          "ai_required": false,
          "estimated_duration": "3秒",
          "data_transformation": "チャンク配列→統合JSON",
          "error_handling": {
            "strategy": "stop_on_error",
            "fallback": "Error Workflowでエラーログ"
          },
          "parameters": {
            "mode": "runOnceForAllItems",
            "language": "javaScript",
            "jsCode": "const allChunks = $input.all();\nconst allLines = [];\n\nfor (const chunk of allChunks) {\n  const chunkData = chunk.json;\n  if (chunkData && Array.isArray(chunkData)) {\n    allLines.push(...chunkData);\n  }\n}\n\nallLines.sort((a, b) => a.line_id - b.line_id);\n\nconst uniqueLines = Array.from(\n  new Map(allLines.map(line => [line.line_id, line])).values()\n);\n\nreturn [{ json: { lines: uniqueLines, total_lines: uniqueLines.length } }];"
          }
        }
      ]
    },
    {
      "group_id": "group_06",
      "group_name": "Step2: 議題抽出",
      "group_purpose": "統合された文字起こしから会議の議題を自動抽出する",
      "group_description": "全文字起こしを分析し、議題ごとにグループ化、該当するline_idsを記録",
      "sticky_note_color": 2,
      "estimated_duration": "20-30秒",
      "execution_pattern": "sequential",
      "tasks": [
        {
          "id": "node_011",
          "name": "AI Agent: Step2 議題抽出",
          "description": "文字起こし全体から議題を抽出し、各議題に該当する行番号を記録する",
          "layer": "Transform",
          "node_type": "@n8n/n8n-nodes-langchain.agent",
          "execution_mode": "sequential",
          "dependencies": ["node_010"],
          "ai_required": true,
          "ai_responsibility": "議題抽出とline_ids記録",
          "estimated_duration": "20-30秒",
          "data_transformation": "統合JSON→議題JSON",
          "error_handling": {
            "strategy": "retry_once",
            "fallback": "Error Workflowで部分生成議事録を保存"
          },
          "subnodes": [
            {
              "subnode_id": "subnode_011_01",
              "subnode_name": "Google Gemini Chat Model",
              "subnode_type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
              "connection_type": "ai_languageModel",
              "parameters": {
                "modelName": "models/gemini-2.0-flash-exp",
                "options": {"temperature": 0.4, "maxTokens": 4000, "topK": 40, "topP": 0.9}
              }
            },
            {
              "subnode_id": "subnode_011_02",
              "subnode_name": "Simple Memory",
              "subnode_type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
              "connection_type": "ai_memory",
              "parameters": {
                "sessionIdType": "customKey",
                "sessionKey": "step2_memory",
                "contextWindowLength": 10
              }
            }
          ],
          "parameters": {
            "promptType": "define",
            "text": "以下の整形済み文字起こしから、会議の議題を抽出してください：\n\n{{ $json.lines }}\n\n【指示】\n1. 会話の流れから自然な議題の区切りを見つける\n2. 各議題に適切なタイトルを付ける\n3. 各議題に該当する行番号（line_id）を配列で記録\n4. 会議名も推測して抽出\n\n【出力形式】\nJSON：{\"meeting_name\": \"会議名\", \"agendas\": [{\"agenda_id\": 1, \"title\": \"議題\", \"line_ids\": [1,2,3]}, ...]}",
            "options": {"systemMessage": "あなたは会議の議事録作成の専門家です。"},
            "hasOutputParser": true
          }
        }
      ]
    },
    {
      "group_id": "group_07",
      "group_name": "議題ごとのデータ再構成",
      "group_purpose": "各議題に該当する全文字起こしを収集する",
      "group_description": "Step2で抽出したline_idsを基に、各議題の完全なデータセットを構築",
      "sticky_note_color": 1,
      "estimated_duration": "2秒",
      "execution_pattern": "sequential",
      "tasks": [
        {
          "id": "node_012",
          "name": "Code: 議題ごとのデータ再構成",
          "description": "各議題のline_idsに対応する文字起こしを統合JSONから抽出する",
          "layer": "Transform",
          "node_type": "n8n-nodes-base.code",
          "execution_mode": "sequential",
          "dependencies": ["node_011"],
          "ai_required": false,
          "estimated_duration": "2秒",
          "data_transformation": "議題JSON→議題別完全データ",
          "error_handling": {
            "strategy": "stop_on_error",
            "fallback": "Error Workflowでエラーログ"
          },
          "parameters": {
            "mode": "runOnceForAllItems",
            "language": "javaScript",
            "jsCode": "const step2Output = $input.first().json;\nconst allLines = $('Code: チャンク統合+重複除去').first().json.lines;\n\nconst agendas = step2Output.agendas;\nconst reconstructedAgendas = [];\n\nfor (const agenda of agendas) {\n  const lines = agenda.line_ids.map(id => {\n    return allLines.find(line => line.line_id === id);\n  }).filter(line => line !== undefined);\n  \n  let duration = '0秒';\n  if (lines.length > 0 && lines[0].start_time !== undefined && lines[lines.length - 1].end_time !== undefined) {\n    const durationSeconds = Math.floor(lines[lines.length - 1].end_time - lines[0].start_time);\n    const minutes = Math.floor(durationSeconds / 60);\n    const seconds = durationSeconds % 60;\n    duration = minutes > 0 ? `${minutes}分${seconds}秒` : `${seconds}秒`;\n  }\n  \n  reconstructedAgendas.push({\n    agenda_id: agenda.agenda_id,\n    title: agenda.title,\n    lines: lines,\n    context: {\n      total_lines: lines.length,\n      duration: duration,\n      line_ids: agenda.line_ids\n    }\n  });\n}\n\nreturn reconstructedAgendas.map(agenda => ({ json: agenda }));"
          }
        }
      ]
    },
    {
      "group_id": "group_08",
      "group_name": "Step3: 議題分析（並列3議題）",
      "group_purpose": "各議題から決定事項、宿題、保留事項を抽出する（並列処理）",
      "group_description": "3議題並列で分析し、処理時間を3倍高速化する",
      "sticky_note_color": 0,
      "estimated_duration": "30-60秒",
      "execution_pattern": "parallel",
      "tasks": [
        {
          "id": "node_013",
          "name": "Split in Batches: 議題並列処理",
          "description": "議題を3個ずつのバッチに分割して並列処理を可能にする",
          "layer": "Transform",
          "node_type": "n8n-nodes-base.splitInBatches",
          "execution_mode": "sequential",
          "dependencies": ["node_012"],
          "ai_required": false,
          "estimated_duration": "0秒",
          "data_transformation": "議題配列→バッチ",
          "error_handling": {
            "strategy": "continue_on_error",
            "fallback": "エラー議題はスキップ"
          },
          "parameters": {
            "batchSize": 3,
            "options": {"reset": false}
          }
        },
        {
          "id": "node_014",
          "name": "AI Agent: Step3 議題分析",
          "description": "各議題から決定事項、宿題、保留事項を抽出する（並列実行）",
          "layer": "Transform",
          "node_type": "@n8n/n8n-nodes-langchain.agent",
          "execution_mode": "parallel",
          "dependencies": ["node_013"],
          "ai_required": true,
          "ai_responsibility": "決定事項、宿題、保留事項の抽出",
          "estimated_duration": "20-40秒/議題",
          "data_transformation": "議題データ→分析JSON",
          "error_handling": {
            "strategy": "retry_once",
            "fallback": "Error Workflowで部分生成議事録を保存"
          },
          "subnodes": [
            {
              "subnode_id": "subnode_014_01",
              "subnode_name": "Google Gemini Chat Model",
              "subnode_type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
              "connection_type": "ai_languageModel",
              "parameters": {
                "modelName": "models/gemini-2.0-flash-exp",
                "options": {"temperature": 0.4, "maxTokens": 4000, "topK": 40, "topP": 0.9}
              }
            }
          ],
          "parameters": {
            "promptType": "define",
            "text": "以下の議題から決定事項、宿題、保留事項を抽出してください：\n\n【議題】{{ $json.title }}\n【文字起こし】{{ $json.lines }}\n\n【出力形式】\nJSON：{\"agenda_id\": {{ $json.agenda_id }}, \"title\": \"{{ $json.title }}\", \"decisions\": [...], \"todos\": [...], \"pending\": [...]}",
            "options": {"systemMessage": "あなたは会議の分析専門家です。"},
            "hasOutputParser": true
          }
        },
        {
          "id": "node_015",
          "name": "Loop Back: バッチ処理継続",
          "description": "全バッチ処理が完了するまでループバックする",
          "layer": "Transform",
          "node_type": "n8n-nodes-base.splitInBatches",
          "execution_mode": "sequential",
          "dependencies": ["node_014"],
          "ai_required": false,
          "estimated_duration": "0秒",
          "data_transformation": "バッチループ制御",
          "error_handling": {
            "strategy": "continue",
            "fallback": "次のバッチへ"
          },
          "parameters": {"mode": "loop"}
        }
      ]
    },
    {
      "group_id": "group_09",
      "group_name": "Step4-5: フォーマット変換と品質保証",
      "group_purpose": "全データをMarkdown議事録に変換し、品質を検証する",
      "group_description": "Claude Sonnet 4.5で高品質なMarkdown議事録を生成し、完全性を検証",
      "sticky_note_color": 7,
      "estimated_duration": "50-75秒",
      "execution_pattern": "sequential",
      "tasks": [
        {
          "id": "node_016",
          "name": "AI Agent: Step4 フォーマット変換",
          "description": "全データを統合し、指定フォーマットのMarkdown議事録を生成する",
          "layer": "Transform",
          "node_type": "@n8n/n8n-nodes-langchain.agent",
          "execution_mode": "sequential",
          "dependencies": ["node_015"],
          "ai_required": true,
          "ai_responsibility": "Markdown議事録生成",
          "estimated_duration": "30-45秒",
          "data_transformation": "全データ→Markdown",
          "error_handling": {
            "strategy": "retry_once",
            "fallback": "Error Workflowで部分生成議事録を保存"
          },
          "subnodes": [
            {
              "subnode_id": "subnode_016_01",
              "subnode_name": "Anthropic Chat Model",
              "subnode_type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
              "connection_type": "ai_languageModel",
              "parameters": {
                "model": {"__rl": true, "mode": "list", "value": "claude-sonnet-4-5-20250929"},
                "options": {"temperature": 0.7, "maxTokens": 8000, "topK": 40, "topP": 0.9}
              }
            },
            {
              "subnode_id": "subnode_016_02",
              "subnode_name": "Simple Memory",
              "subnode_type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
              "connection_type": "ai_memory",
              "parameters": {
                "sessionIdType": "customKey",
                "sessionKey": "step4_memory",
                "contextWindowLength": 10
              }
            }
          ],
          "parameters": {
            "promptType": "define",
            "text": "以下のデータから指定フォーマットのMarkdown議事録を生成してください：\n\n【データ】\n- 会議名: {{ $('AI Agent: Step2 議題抽出').first().json.meeting_name }}\n- ファイル作成日時: {{ $('Google Drive: Get File Info').first().json.createdTime }}\n- 議題一覧: {{ $input.all() }}\n- 全文字起こし: {{ $('Code: チャンク統合+重複除去').first().json.lines }}\n\n【指定フォーマット】\n# 目的・背景\n# 日時\n# 参加者\n# 宿題事項\n# 決定事項\n# 次回の日時\n# 議事内容\n\n【出力】完全なMarkdownテキストを返してください。",
            "options": {"systemMessage": "あなたは議事録作成の専門家です。"}
          }
        },
        {
          "id": "node_017",
          "name": "AI Agent: Step5 品質保証",
          "description": "生成された議事録の完全性を検証し、不足項目を補完する",
          "layer": "Transform",
          "node_type": "@n8n/n8n-nodes-langchain.agent",
          "execution_mode": "sequential",
          "dependencies": ["node_016"],
          "ai_required": true,
          "ai_responsibility": "議事録の完全性検証と補完",
          "estimated_duration": "20-30秒",
          "data_transformation": "Markdown→検証済みMarkdown",
          "error_handling": {
            "strategy": "continue_on_error",
            "fallback": "警告付きで議事録を保存"
          },
          "subnodes": [
            {
              "subnode_id": "subnode_017_01",
              "subnode_name": "Anthropic Chat Model",
              "subnode_type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
              "connection_type": "ai_languageModel",
              "parameters": {
                "model": {"__rl": true, "mode": "list", "value": "claude-sonnet-4-5-20250929"},
                "options": {"temperature": 0.7, "maxTokens": 8000, "topK": 40, "topP": 0.9}
              }
            },
            {
              "subnode_id": "subnode_017_02",
              "subnode_name": "Simple Memory",
              "subnode_type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
              "connection_type": "ai_memory",
              "parameters": {
                "sessionIdType": "customKey",
                "sessionKey": "step5_memory",
                "contextWindowLength": 10
              }
            }
          ],
          "parameters": {
            "promptType": "define",
            "text": "以下の議事録の完全性を検証し、不足項目があれば補完してください：\n\n【生成された議事録】{{ $('AI Agent: Step4 フォーマット変換').first().json.output }}\n【元データ】全議題: {{ $('AI Agent: Step3 議題分析').all() }}\n\n【出力形式】\nJSON：{\"status\": \"ok|補完実施|警告\", \"markdown\": \"最終議事録\", \"warnings\": [...]}",
            "options": {"systemMessage": "あなたは品質保証の専門家です。"},
            "hasOutputParser": true
          }
        }
      ]
    },
    {
      "group_id": "group_10",
      "group_name": "議事録保存とファイル整理",
      "group_purpose": "最終議事録をGoogle Driveに保存し、元のM4Aファイルを移動する",
      "group_description": "議事録を指定フォルダに保存し、処理済みM4Aファイルを整理",
      "sticky_note_color": 6,
      "estimated_duration": "10-15秒",
      "execution_pattern": "sequential",
      "tasks": [
        {
          "id": "node_018",
          "name": "IF: 品質保証ステータス判定",
          "description": "品質保証のステータスがokまたは補完実施の場合のみ保存する",
          "layer": "Decision",
          "node_type": "n8n-nodes-base.if",
          "execution_mode": "sequential",
          "dependencies": ["node_017"],
          "ai_required": false,
          "estimated_duration": "0秒",
          "data_transformation": "条件分岐",
          "error_handling": {
            "strategy": "route_to_error_workflow",
            "fallback": "False Path → Error Workflow"
          },
          "parameters": {
            "conditions": {
              "options": {"version": 2, "caseSensitive": true, "typeValidation": "strict"},
              "combinator": "or",
              "conditions": [
                {"id": "cond_001", "operator": {"type": "string", "operation": "equals"}, "leftValue": "={{ $json.status }}", "rightValue": "ok"},
                {"id": "cond_002", "operator": {"type": "string", "operation": "equals"}, "leftValue": "={{ $json.status }}", "rightValue": "補完実施"}
              ]
            }
          }
        },
        {
          "id": "node_019",
          "name": "Google Drive: 議事録保存",
          "description": "最終議事録をGoogle Driveの指定フォルダに保存する",
          "layer": "Action",
          "node_type": "n8n-nodes-base.googleDrive",
          "execution_mode": "sequential",
          "dependencies": ["node_018"],
          "ai_required": false,
          "estimated_duration": "5-10秒",
          "data_transformation": "Markdown→Google Drive保存",
          "error_handling": {
            "strategy": "retry_3_times",
            "fallback": "Error Workflowでn8n内部ストレージに一時保存"
          },
          "parameters": {
            "resource": "file",
            "operation": "upload",
            "name": "=minutes - {{ $now.format('YYYY-MM-DD') }} - {{ $('AI Agent: Step2 議題抽出').first().json.meeting_name }}.md",
            "driveId": {"__rl": true, "mode": "list", "value": "My Drive"},
            "folderId": {"__rl": true, "mode": "id", "value": "議事録_出力フォルダID"},
            "options": {"mimeType": "text/markdown"},
            "binaryData": false,
            "fileContent": "={{ $json.markdown }}"
          }
        },
        {
          "id": "node_020",
          "name": "Google Drive: M4Aファイル移動",
          "description": "処理済みM4Aファイルをprocessed/フォルダに移動する",
          "layer": "Action",
          "node_type": "n8n-nodes-base.googleDrive",
          "execution_mode": "sequential",
          "dependencies": ["node_019"],
          "ai_required": false,
          "estimated_duration": "3-5秒",
          "data_transformation": "M4Aファイル移動",
          "error_handling": {
            "strategy": "continue_on_error",
            "fallback": "移動失敗してもワークフロー完了"
          },
          "parameters": {
            "resource": "file",
            "operation": "move",
            "fileId": {"__rl": true, "mode": "id", "value": "={{ $('Google Drive Trigger').first().json.id }}"},
            "driveId": {"__rl": true, "mode": "list", "value": "My Drive"},
            "folderId": {"__rl": true, "mode": "id", "value": "processedフォルダID"}
          }
        }
      ]
    },
    {
      "group_id": "group_11",
      "group_name": "完了通知（オプション）",
      "group_purpose": "処理完了をDiscordに通知する",
      "group_description": "議事録保存完了後、Discordに通知を送信",
      "sticky_note_color": 5,
      "estimated_duration": "2秒",
      "execution_pattern": "sequential",
      "tasks": [
        {
          "id": "node_021",
          "name": "HTTP Request: Discord Webhook",
          "description": "処理完了をDiscordに通知する",
          "layer": "Output",
          "node_type": "n8n-nodes-base.httpRequest",
          "execution_mode": "sequential",
          "dependencies": ["node_020"],
          "ai_required": false,
          "estimated_duration": "2秒",
          "data_transformation": "通知送信",
          "error_handling": {
            "strategy": "continue_on_error",
            "fallback": "通知失敗してもワークフロー完了"
          },
          "parameters": {
            "url": "={{ $env.DISCORD_WEBHOOK_URL }}",
            "method": "POST",
            "sendBody": true,
            "contentType": "json",
            "jsonBody": "={\"content\": \"✅ 議事録生成完了\", \"embeds\": [{\"title\": \"{{ $('AI Agent: Step2 議題抽出').first().json.meeting_name }}\", \"fields\": [{\"name\": \"議事録\", \"value\": \"{{ $('Google Drive: 議事録保存').first().json.webViewLink }}\"}, {\"name\": \"処理時間\", \"value\": \"{{ $workflow.duration }}秒\"}], \"color\": 5814783}]}",
            "options": {}
          }
        }
      ]
    }
  ],
  "group_connections": [
    {"from_group": "group_01", "to_group": "group_02", "connection_description": "M4Aバイナリ→Gemini文字起こし", "data_flow": "M4Aバイナリデータ"},
    {"from_group": "group_02", "to_group": "group_03", "connection_description": "文字起こしJSON→チャンク分割", "data_flow": "JSON配列（話者分離、タイムスタンプ付き）"},
    {"from_group": "group_03", "to_group": "group_04", "connection_description": "チャンク配列→並列整形処理", "data_flow": "チャンク配列"},
    {"from_group": "group_04", "to_group": "group_05", "connection_description": "整形済みチャンク→統合処理", "data_flow": "各チャンクの整形済みJSON"},
    {"from_group": "group_05", "to_group": "group_06", "connection_description": "統合JSON→議題抽出", "data_flow": "統合JSON配列"},
    {"from_group": "group_06", "to_group": "group_07", "connection_description": "議題JSON→データ再構成", "data_flow": "議題JSON"},
    {"from_group": "group_07", "to_group": "group_08", "connection_description": "議題別データ→並列分析", "data_flow": "議題別JSON"},
    {"from_group": "group_08", "to_group": "group_09", "connection_description": "分析結果→フォーマット変換", "data_flow": "全議題の分析結果"},
    {"from_group": "group_09", "to_group": "group_10", "connection_description": "検証済みMarkdown→保存", "data_flow": "最終Markdown"},
    {"from_group": "group_10", "to_group": "group_11", "connection_description": "保存完了→通知", "data_flow": "保存済みファイル情報"}
  ],
  "n8n_mcp_validation_summary": {
    "validation_date": "2025-01-09",
    "validated_nodes": [
      {"nodeType": "@n8n/n8n-nodes-langchain.googleGemini", "resource": "audio", "operation": "transcribe", "valid": true, "note": "M4Aネイティブ対応、最大8.4時間、話者分離・タイムスタンプ対応"},
      {"nodeType": "nodes-base.googleDrive", "operation": "download", "valid": true, "note": "M4Aバイナリダウンロード"},
      {"nodeType": "nodes-langchain.agent", "valid": true, "note": "AI Agent × 5"},
      {"nodeType": "nodes-base.splitInBatches", "valid": true, "note": "バッチ処理 × 2"},
      {"nodeType": "nodes-base.if", "valid": true, "note": "条件分岐"}
    ],
    "total_validated": 5,
    "all_nodes_valid": true,
    "recommendation": "すべてのノードが有効。Gemini文字起こしにより、ワークフローが大幅に簡素化されました。"
  },
  "summary": {
    "total_nodes": 21,
    "by_layer": {
      "Trigger": 1,
      "Fetch": 2,
      "Validate": 1,
      "Transform": 13,
      "Decision": 1,
      "Action": 2,
      "Output": 1
    },
    "ai_nodes": 6,
    "gemini_nodes": {"transcribe": 1, "chat_model": 3},
    "claude_nodes": {"chat_model": 2},
    "loop_nodes": 4,
    "improvements_vs_deepgram": {
      "nodes_removed": 1,
      "nodes_added": 2,
      "net_change": "+1 node",
      "processing_time": "-50%",
      "cost": "-75%",
      "complexity": "simplified"
    }
  }
}
